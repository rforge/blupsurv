<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" href="../robodoc.css" type="text/css" />
<title>./blupsurv/R/bivrecsim.r</title>
<!-- Source: ./blupsurv/R/bivrecsim.r -->
<!-- Generated with ROBODoc Version 4.99.36 (Jun 19 2008) -->
</head>
<body>
<div id="logo">
<a name="robo_top_of_doc">blupsurv</a>
</div> <!-- logo -->
<div id="navigation">
<a class="menuitem" href="../toc_index.html#top">Table of Contents</a>
<a class="menuitem" href="../robo_sourcefiles.html#top">Sourcefiles</a>
<a class="menuitem" href="../masterindex.html#top">Index</a>
<a class="menuitem" href="../robo_functions.html#top">Functions</a>
<a class="menuitem" href="../robo_modules.html#top">Modules</a>
<a class="menuitem" href="../robo_methods.html#top">Methods</a>
</div> <!-- navigation -->
<div id="content">
<h3>TABLE OF CONTENTS</h3>
<ul>
<li>1. <a href="#robo5">/simulation</a></li>
<ul>
<li>1.1. <a href="#robo59">simulation/bivrecsim</a></li>
<li>1.2. <a href="#robo60">simulation/gen2AG</a></li>
<li>1.3. <a href="#robo61">simulation/generatecensoring</a></li>
<li>1.4. <a href="#robo62">simulation/generatecovariate</a></li>
<li>1.5. <a href="#robo63">simulation/generatefrailty</a></li>
<li>1.6. <a href="#robo64">simulation/generaterecurrent</a></li>
<li>1.7. <a href="#robo65">simulation/initsetup</a></li>
<li>1.8. <a href="#robo66">simulation/L</a></li>
</ul>
</ul>
<hr />
<a name="2fsimulation"></a>
<a name="robo5"></a><h2>/simulation [ Modules ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_modules.html#robo_top_of_doc">Modules</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>simulation</strong>
</pre>
<p class="item_name">FUNCTION</p>
<p>    Routines to generate simulated bivariate data. None of these are
    user-facing, they were only used in simulations
</p>

<hr />
<a name="simulation2fbivrecsim"></a>
<a name="robo59"></a><h2>simulation/bivrecsim [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo5">simulation</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>bivrecsim</strong> --- conduct a set of simulations
</pre>
<p class="item_name">FUNCTION</p>
<p>    Conducts simulations and dumps the output to a file
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">30 </span><strong>bivrecsim</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>Nsim<span class="sign">,</span> m <span class="sign">=</span> 10<span class="sign">,</span> Ji <span class="sign">=</span> <span class="keyword">rep</span><span class="sign">(</span>5<span class="sign">,</span> 10<span class="sign">)</span><span class="sign">,</span> K <span class="sign">=</span> 10<span class="sign">,</span> Kd <span class="sign">=</span> 10<span class="sign">,</span> timedep <span class="sign">=</span> FALSE<span class="sign">,</span>
<span class="line_number">31 </span>        dumpfile <span class="sign">=</span> <span class="quote">"dump"</span><span class="sign">,</span> correction <span class="sign">=</span> <span class="quote">"none"</span><span class="sign">,</span> outputfrailties <span class="sign">=</span> FALSE<span class="sign">,</span>
<span class="line_number">32 </span>        computesd <span class="sign">=</span> FALSE<span class="sign">,</span> type <span class="sign">=</span> <span class="quote">"lognormal"</span><span class="sign">,</span> dispest <span class="sign">=</span> <span class="quote">"pearson"</span><span class="sign">,</span> ragged <span class="sign">=</span> FALSE<span class="sign">,</span>
<span class="line_number">33 </span>        censortime <span class="sign">=</span> 100<span class="sign">,</span> fixzero <span class="sign">=</span> NULL<span class="sign">,</span> smooth <span class="sign">=</span> FALSE<span class="sign">,</span> fullS <span class="sign">=</span> TRUE<span class="sign">,</span> boot <span class="sign">=</span> NULL<span class="sign">,</span>
<span class="line_number">34 </span>        verbose <span class="sign">=</span> 2<span class="sign">,</span> maxiter <span class="sign">=</span> 200<span class="sign">,</span> alternating <span class="sign">=</span> FALSE<span class="sign">)</span>
</pre>
<p class="item_name">INPUTS</p>
<pre>    Nsim       number of simulations
    timedep    boolean, whether to use time-depencent covariates
    dumpfile   file into which to dump the results
    outputfrailties    boolean, whether to dump frailty estimates
    type       type of frailties to generate
    ragged     boolean, whether to use clusters of different sizes
    censortime     fixed censoring time
    ...        other parameters matching those of <a href="./bivrec_r.html#robo11">bivrec.agdata</a>
</pre>
<p class="item_name">OUTPUTS</p>
<pre>    a dump file containing <a href="#robo5">simulation</a> results
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number"> 37 </span><span class="sign">{</span>
<span class="line_number"> 38 </span>        
<span class="line_number"> 39 </span>    <span class="comment"># Set global variables</span>
<span class="line_number"> 40 </span>    params <span class="sign">&lt;</span><span class="sign">-</span> <a href="#robo65">initsetup</a><span class="sign">(</span>timedep<span class="sign">,</span> m<span class="sign">,</span> Ji<span class="sign">,</span> K<span class="sign">,</span> Kd<span class="sign">,</span> fixzero<span class="sign">,</span> alternating<span class="sign">)</span>
<span class="line_number"> 41 </span>    
<span class="line_number"> 42 </span>    <span class="comment"># Simulation loop</span>
<span class="line_number"> 43 </span>     <span class="keyword">for</span><span class="sign">(</span>isim in 1<span class="sign">:</span>Nsim<span class="sign">)</span><span class="sign">{</span>
<span class="line_number"> 44 </span>        
<span class="line_number"> 45 </span>        <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"\nSimulation "</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">)</span>
<span class="line_number"> 46 </span>        <span class="keyword">if</span><span class="sign">(</span>ragged<span class="sign">)</span><span class="sign">{</span>
<span class="line_number"> 47 </span>            Jilocal <span class="sign">&lt;</span><span class="sign">-</span> ceiling<span class="sign">(</span>runif<span class="sign">(</span>m<span class="sign">)</span> <span class="sign">*</span> max<span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span>
<span class="line_number"> 48 </span>        <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number"> 49 </span>            Jilocal <span class="sign">&lt;</span><span class="sign">-</span> Ji
<span class="line_number"> 50 </span>        <span class="sign">}</span>
<span class="line_number"> 51 </span>
<span class="line_number"> 52 </span>        <span class="comment">###########################</span>
<span class="line_number"> 53 </span>        <span class="comment">#### Begin <a href="./bivrec_r.html#robo8">initialization</a> of <a href="#robo5">simulation</a> i:</span>
<span class="line_number"> 54 </span>        
<span class="line_number"> 55 </span>        <span class="comment">## Generate frailties, events, deaths, etc. There must be at least one event</span>
<span class="line_number"> 56 </span>        <span class="comment">## and one death in each cluster.</span>
<span class="line_number"> 57 </span>        nclustevents1 <span class="sign">&lt;</span><span class="sign">-</span> 0<span class="sign">;</span> nclustevents2 <span class="sign">&lt;</span><span class="sign">-</span> 0<span class="sign">;</span>ngens <span class="sign">&lt;</span><span class="sign">-</span> 0
<span class="line_number"> 58 </span>        <span class="keyword">while</span><span class="sign">(</span>min<span class="sign">(</span>nclustevents1<span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> 0 <span class="sign">|</span> min<span class="sign">(</span>nclustevents2<span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> 0<span class="sign">)</span><span class="sign">{</span>
<span class="line_number"> 59 </span>        
<span class="line_number"> 60 </span>            <span class="comment">#### Generate frailties:</span>
<span class="line_number"> 61 </span>            UV <span class="sign">&lt;</span><span class="sign">-</span> <a href="#robo63">generatefrailty</a><span class="sign">(</span>type <span class="sign">=</span> type<span class="sign">,</span> params<span class="sign">)</span>
<span class="line_number"> 62 </span>            Ui <span class="sign">&lt;</span><span class="sign">-</span> UV<span class="sign">$</span>Ui<span class="sign">;</span> Vi <span class="sign">&lt;</span><span class="sign">-</span> UV<span class="sign">$</span>Vi<span class="sign">;</span> Uij <span class="sign">&lt;</span><span class="sign">-</span> UV<span class="sign">$</span>Uij<span class="sign">;</span> Vij <span class="sign">&lt;</span><span class="sign">-</span> UV<span class="sign">$</span>Vij<span class="sign">;</span> 
<span class="line_number"> 63 </span>            
<span class="line_number"> 64 </span>            <span class="comment">## Generate a single covariate value (may or may not be constant)</span>
<span class="line_number"> 65 </span>            Zij <span class="sign">&lt;</span><span class="sign">-</span> <a href="#robo62">generatecovariate</a><span class="sign">(</span>params<span class="sign">)</span>
<span class="line_number"> 66 </span>
<span class="line_number"> 67 </span>            <span class="comment">## Compute followup times</span>
<span class="line_number"> 68 </span>            Cij <span class="sign">&lt;</span><span class="sign">-</span> <a href="#robo61">generatecensoring</a><span class="sign">(</span>m<span class="sign">,</span> Jilocal<span class="sign">,</span> params<span class="sign">$</span>lambda0c<span class="sign">,</span> params<span class="sign">$</span>gamweibc<span class="sign">)</span>
<span class="line_number"> 69 </span>            
<span class="line_number"> 70 </span>            <span class="comment">## Generate recurrent event times</span>
<span class="line_number"> 71 </span>            Rij1 <span class="sign">&lt;</span><span class="sign">-</span> <a href="#robo64">generaterecurrent</a><span class="sign">(</span>m<span class="sign">,</span> Jilocal<span class="sign">,</span> Zij<span class="sign">,</span> Uij<span class="sign">,</span> params<span class="sign">$</span>beta1<span class="sign">,</span>
<span class="line_number"> 72 </span>                params<span class="sign">$</span>beta2<span class="sign">,</span> params<span class="sign">$</span>lambda0<span class="sign">,</span> params<span class="sign">$</span>gamweib<span class="sign">,</span> params<span class="sign">$</span>timedep<span class="sign">,</span> Cij<span class="sign">)</span>
<span class="line_number"> 73 </span>            Rij2 <span class="sign">&lt;</span><span class="sign">-</span> <a href="#robo64">generaterecurrent</a><span class="sign">(</span>m<span class="sign">,</span> Jilocal<span class="sign">,</span> Zij<span class="sign">,</span> Vij<span class="sign">,</span> params<span class="sign">$</span>beta1d<span class="sign">,</span>
<span class="line_number"> 74 </span>                params<span class="sign">$</span>beta2d<span class="sign">,</span> params<span class="sign">$</span>lambda0d<span class="sign">,</span> params<span class="sign">$</span>gamweibd<span class="sign">,</span> params<span class="sign">$</span>timedep<span class="sign">,</span> Cij<span class="sign">)</span>
<span class="line_number"> 75 </span>            
<span class="line_number"> 76 </span>            <span class="comment">## Generate death times, based on covariates and frailty</span>
<span class="line_number"> 77 </span>            <span class="comment">#Dij &lt;- generatedeath(Zij, Rij, Vij, m, Jilocal)</span>
<span class="line_number"> 78 </span>            
<span class="line_number"> 79 </span>            
<span class="line_number"> 80 </span>            <span class="comment">## Compute the number of recurrent events observed</span>
<span class="line_number"> 81 </span>            nevents1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Jilocal<span class="sign">)</span><span class="sign">)</span>
<span class="line_number"> 82 </span>            nevents2 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Jilocal<span class="sign">)</span><span class="sign">)</span>
<span class="line_number"> 83 </span>            <span class="keyword">for</span><span class="sign">(</span>ij in 1<span class="sign">:</span><span class="keyword">sum</span><span class="sign">(</span>Jilocal<span class="sign">)</span><span class="sign">)</span> nevents1<span class="sign">[</span>ij<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span><span class="keyword">cumsum</span><span class="sign">(</span>Rij1<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span> <span class="sign">&lt;</span> Cij<span class="sign">[</span>ij<span class="sign">]</span><span class="sign">)</span>
<span class="line_number"> 84 </span>            <span class="keyword">for</span><span class="sign">(</span>ij in 1<span class="sign">:</span><span class="keyword">sum</span><span class="sign">(</span>Jilocal<span class="sign">)</span><span class="sign">)</span> nevents2<span class="sign">[</span>ij<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span><span class="keyword">cumsum</span><span class="sign">(</span>Rij2<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span> <span class="sign">&lt;</span> Cij<span class="sign">[</span>ij<span class="sign">]</span><span class="sign">)</span>
<span class="line_number"> 85 </span>            <span class="comment">## Compute the number of events and deaths observed in each cluster</span>
<span class="line_number"> 86 </span>            ij <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>1<span class="sign">:</span>m<span class="sign">,</span> Jilocal<span class="sign">)</span>
<span class="line_number"> 87 </span>            <span class="keyword">for</span> <span class="sign">(</span>i in 1<span class="sign">:</span>m<span class="sign">)</span><span class="sign">{</span>
<span class="line_number"> 88 </span>                nclustevents1<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>nevents1<span class="sign">[</span>ij <span class="sign">=</span><span class="sign">=</span> i<span class="sign">]</span><span class="sign">)</span>
<span class="line_number"> 89 </span>                nclustevents2<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>nevents2<span class="sign">[</span>ij <span class="sign">=</span><span class="sign">=</span> i<span class="sign">]</span><span class="sign">)</span>
<span class="line_number"> 90 </span>            <span class="sign">}</span>
<span class="line_number"> 91 </span>            ngens <span class="sign">&lt;</span><span class="sign">-</span> ngens <span class="sign">+</span> 1
<span class="line_number"> 92 </span>            
<span class="line_number"> 93 </span>         <span class="comment">#   if(alternating &amp; any(nevents1 == 0)) nclustevents1 &lt;- 0</span>
<span class="line_number"> 94 </span>            
<span class="line_number"> 95 </span>        <span class="sign">}</span>
<span class="line_number"> 96 </span>        
<span class="line_number"> 97 </span>        <span class="comment">## Transform generated data into Anderson - Gill format</span>
<span class="line_number"> 98 </span>        agdata <span class="sign">&lt;</span><span class="sign">-</span> <a href="#robo60">gen2AG</a><span class="sign">(</span>m<span class="sign">,</span> Jilocal<span class="sign">,</span> Zij<span class="sign">,</span> Rij1<span class="sign">,</span> Rij2<span class="sign">,</span> Cij<span class="sign">,</span> alternating<span class="sign">,</span> params<span class="sign">$</span>timedep<span class="sign">)</span>
<span class="line_number"> 99 </span>            
<span class="line_number">100 </span>        <span class="comment">## Clean up <a href="./bivrec_r.html#robo8">initialization</a></span>
<span class="line_number">101 </span>        <span class="comment">#rm(Dij, Rij, Xij, nevents, nclustevents, nclustdeath, UV)</span>
<span class="line_number">102 </span>        
<span class="line_number">103 </span>        <span class="comment">## Fit the model:</span>
<span class="line_number">104 </span>        fit <span class="sign">&lt;</span><span class="sign">-</span> <a href="./bivmethods_r.html#robo38">bivrec</a><span class="sign">(</span>agdata<span class="sign">,</span> K<span class="sign">,</span> Kd<span class="sign">,</span> correction<span class="sign">,</span> dispest <span class="sign">=</span> dispest<span class="sign">,</span>
<span class="line_number">105 </span>            computesd <span class="sign">=</span> computesd<span class="sign">,</span> fixzero <span class="sign">=</span> fixzero<span class="sign">,</span> smooth <span class="sign">=</span> smooth<span class="sign">,</span> fullS <span class="sign">=</span> fullS<span class="sign">,</span>
<span class="line_number">106 </span>            verbose <span class="sign">=</span> verbose<span class="sign">,</span> maxiter <span class="sign">=</span> maxiter<span class="sign">,</span> alternating <span class="sign">=</span> alternating<span class="sign">)</span>
<span class="line_number">107 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="comment">!is.null(boot)){</span>
<span class="line_number">108 </span>            bootopts <span class="sign">&lt;</span><span class="sign">-</span> paste<span class="sign">(</span>names<span class="sign">(</span>boot<span class="sign">)</span><span class="sign">,</span> boot<span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">" = "</span><span class="sign">,</span> collapse <span class="sign">=</span> <span class="quote">", "</span><span class="sign">)</span>
<span class="line_number">109 </span>            bootout <span class="sign">&lt;</span><span class="sign">-</span> NULL<span class="sign">;</span>
<span class="line_number">110 </span>            bootstring <span class="sign">&lt;</span><span class="sign">-</span> paste<span class="sign">(</span><span class="quote">"bootout &lt;- bootrd(agdata, fit, "</span><span class="sign">,</span> bootopts<span class="sign">,</span> <span class="quote">")"</span><span class="sign">,</span>
<span class="line_number">111 </span>                sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span>
<span class="line_number">112 </span>            eval<span class="sign">(</span>parse<span class="sign">(</span>text <span class="sign">=</span> bootstring<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">113 </span>        <span class="sign">}</span>
<span class="line_number">114 </span>        
<span class="line_number">115 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="comment">!is.null(names(fit))){</span>
<span class="line_number">116 </span>            <span class="comment">## DEBUG: Dump stuff to a file</span>
<span class="line_number">117 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tbetahat:\t"</span><span class="sign">,</span> fit<span class="sign">$</span>regressionoutput<span class="sign">$</span>betahat<span class="sign">,</span> <span class="quote">"\n"</span> <span class="sign">,</span> 
<span class="line_number">118 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">119 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tbetadhat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>regressionoutput<span class="sign">$</span>betadhat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">120 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">121 </span>            <span class="keyword">if</span><span class="sign">(</span>computesd<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">122 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tstdbetahat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>stderr<span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">123 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">124 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tstdbetadhat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>stderr<span class="sign">[</span>2<span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">125 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">126 </span>            <span class="sign">}</span>
<span class="line_number">127 </span>            <span class="keyword">if</span><span class="sign">(</span>outputfrailties<span class="sign">)</span><span class="sign">{</span> 
<span class="line_number">128 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tUi:\t "</span><span class="sign">,</span> Ui<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">129 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>  
<span class="line_number">130 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tUihat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>frailtyoutput<span class="sign">$</span>Uihat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">131 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>  
<span class="line_number">132 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tVi:\t "</span><span class="sign">,</span> Vi<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">133 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>  
<span class="line_number">134 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tVihat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>frailtyoutput<span class="sign">$</span>Vihat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">135 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>  
<span class="line_number">136 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tUij:\t "</span><span class="sign">,</span> Uij<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">137 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>  
<span class="line_number">138 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tUijhat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>frailtyoutput<span class="sign">$</span>Uijhat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">139 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>  
<span class="line_number">140 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tVij:\t "</span><span class="sign">,</span> Vij<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">141 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>  
<span class="line_number">142 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tVijhat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>frailtyoutput<span class="sign">$</span>Vijhat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">143 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">144 </span>            <span class="sign">}</span>
<span class="line_number">145 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tsigma2hat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>dispparams<span class="sign">$</span>sigma2hat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">146 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">147 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tsigma2dhat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>dispparams<span class="sign">$</span>sigma2dhat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">148 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">149 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tnu2hat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>dispparams<span class="sign">$</span>nu2hat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">150 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">151 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tnu2dhat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>dispparams<span class="sign">$</span>nu2dhat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">152 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>    
<span class="line_number">153 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tthetahat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>dispparams<span class="sign">$</span>thetahat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">154 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">155 </span> 
<span class="line_number">156 </span>           <span class="comment"># Dump initial values to file</span>
<span class="line_number">157 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tbetahat:\t"</span><span class="sign">,</span> fit<span class="sign">$</span>initial<span class="sign">$</span>betahat<span class="sign">,</span> <span class="quote">"\n"</span> <span class="sign">,</span>
<span class="line_number">158 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".init.txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">159 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tbetadhat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>initial<span class="sign">$</span>betadhat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">160 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".init.txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>           
<span class="line_number">161 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tsigma2hat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>initial<span class="sign">$</span>dispparams<span class="sign">$</span>sigma2hat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">162 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".init.txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">163 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tsigma2dhat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>initial<span class="sign">$</span>dispparams<span class="sign">$</span>sigma2dhat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">164 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".init.txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">165 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tnu2hat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>initial<span class="sign">$</span>dispparams<span class="sign">$</span>nu2hat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">166 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".init.txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">167 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tnu2dhat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>initial<span class="sign">$</span>dispparams<span class="sign">$</span>nu2dhat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">168 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".init.txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>    
<span class="line_number">169 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tthetahat:\t "</span><span class="sign">,</span> fit<span class="sign">$</span>initial<span class="sign">$</span>dispparams<span class="sign">$</span>thetahat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">170 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".init.txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">171 </span> 
<span class="line_number">172 </span> 
<span class="line_number">173 </span>        <span class="sign">}</span>
<span class="line_number">174 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="comment">!is.null(boot)) {</span>
<span class="line_number">175 </span>            <span class="keyword">if</span><span class="sign">(</span><span class="comment">!is.null(names(bootout))){</span>
<span class="line_number">176 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.betahat:\t"</span><span class="sign">,</span> bootout<span class="sign">$</span>mean<span class="sign">$</span>betahat<span class="sign">,</span> <span class="quote">"\n"</span> <span class="sign">,</span>
<span class="line_number">177 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">178 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.betadhat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>mean<span class="sign">$</span>betadhat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">179 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">180 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.stdbetahat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>sd<span class="sign">$</span>betahat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">181 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">182 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.stdbetadhat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>sd<span class="sign">$</span>betadhat<span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">183 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">184 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.sigma2hat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>mean<span class="sign">$</span>dispparams<span class="sign">[</span><span class="quote">"sigma2hat"</span><span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">185 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">186 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.sigma2dhat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>mean<span class="sign">$</span>dispparams<span class="sign">[</span><span class="quote">"sigma2dhat"</span><span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">187 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">188 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.nu2hat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>mean<span class="sign">$</span>dispparams<span class="sign">[</span><span class="quote">"nu2hat"</span><span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">189 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">190 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.nu2dhat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>mean<span class="sign">$</span>dispparams<span class="sign">[</span><span class="quote">"nu2dhat"</span><span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">191 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>    
<span class="line_number">192 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.thetahat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>mean<span class="sign">$</span>dispparams<span class="sign">[</span><span class="quote">"thetahat"</span><span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">193 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">194 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.stdsigma2hat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>sd<span class="sign">$</span>dispparams<span class="sign">[</span><span class="quote">"sigma2hat"</span><span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">195 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">196 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.stdsigma2dhat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>sd<span class="sign">$</span>dispparams<span class="sign">[</span><span class="quote">"sigma2dhat"</span><span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">197 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">198 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.stdnu2hat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>sd<span class="sign">$</span>dispparams<span class="sign">[</span><span class="quote">"nu2hat"</span><span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">199 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">200 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.stdnu2dhat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>sd<span class="sign">$</span>dispparams<span class="sign">[</span><span class="quote">"nu2dhat"</span><span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">201 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>    
<span class="line_number">202 </span>            <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"Sim:\t"</span><span class="sign">,</span> isim<span class="sign">,</span> <span class="quote">"\tboot.stdthetahat:\t "</span><span class="sign">,</span> bootout<span class="sign">$</span>sd<span class="sign">$</span>dispparams<span class="sign">[</span><span class="quote">"thetahat"</span><span class="sign">]</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">,</span> 
<span class="line_number">203 </span>                                file <span class="sign">=</span> paste<span class="sign">(</span>dumpfile<span class="sign">,</span> <span class="quote">".txt"</span><span class="sign">,</span> sep <span class="sign">=</span> <span class="quote">""</span><span class="sign">)</span><span class="sign">,</span> append <span class="sign">=</span> TRUE<span class="sign">)</span>      
<span class="line_number">204 </span>            <span class="sign">}</span>
<span class="line_number">205 </span>        <span class="sign">}</span>
<span class="line_number">206 </span>
<span class="line_number">207 </span>    <span class="sign">}</span>
<span class="line_number">208 </span>    
<span class="line_number">209 </span><span class="sign">}</span>
</pre>

<hr />
<a name="simulation2fgen2AG"></a>
<a name="robo60"></a><h2>simulation/gen2AG [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo5">simulation</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>gen2AG</strong>
</pre>
<p class="item_name">FUNCTION</p>
<p>    Convert generated data into Anderson - Gill format
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">306 </span><strong>gen2AG</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>m<span class="sign">,</span> Ji<span class="sign">,</span> Zij<span class="sign">,</span> Rij1<span class="sign">,</span> Rij2<span class="sign">,</span> Cij<span class="sign">,</span> alternating<span class="sign">,</span> timedep<span class="sign">)</span><span class="sign">{</span>
</pre>
<p class="item_name">INPUTS</p>
<pre>    m      number of clusters
    Ji     cluster size
    Zij    list of generated covariates and times
    Rij1   recurrent event gap times 1
    Rij2   recurrent event gap times 2
    Cij    censoring times
    alternating  boolean epsisodic data indicator
    timedep      time-dependent covariate indicator
</pre>
<p class="item_name">OUTPUTS</p>
<pre>    data frame in format used by <a href="./bivrec_r.html#robo11">bivrec.agdata</a>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">309 </span>    <span class="keyword">if</span><span class="sign">(</span>timedep<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">310 </span>        Zij1 <span class="sign">&lt;</span><span class="sign">-</span> Zij<span class="sign">$</span>Zij1
<span class="line_number">311 </span>        Zij1times <span class="sign">&lt;</span><span class="sign">-</span> Zij<span class="sign">$</span>Zij1times
<span class="line_number">312 </span>        Zij2 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">dim</span><span class="sign">(</span>Zij1<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">313 </span>    <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">314 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="comment">!is.matrix(Zij) &amp;&amp; !is.list(Zij)) {</span>
<span class="line_number">315 </span>            Zij1 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span><span class="keyword">rep</span><span class="sign">(</span>Zij<span class="sign">,</span> 100<span class="sign">)</span><span class="sign">,</span> <span class="keyword">length</span><span class="sign">(</span>Zij<span class="sign">)</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">316 </span>            Zij2 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">dim</span><span class="sign">(</span>Zij1<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">317 </span>        <span class="sign">}</span>
<span class="line_number">318 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span><span class="keyword">list</span><span class="sign">(</span>Zij<span class="sign">)</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">319 </span>            Zij1 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span><span class="keyword">rep</span><span class="sign">(</span>Zij<span class="sign">$</span>Zij1<span class="sign">,</span> 100<span class="sign">)</span><span class="sign">,</span> <span class="keyword">length</span><span class="sign">(</span>Zij<span class="sign">$</span>Zij1<span class="sign">)</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">320 </span>            Zij2 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span><span class="keyword">rep</span><span class="sign">(</span>Zij<span class="sign">$</span>Zij2<span class="sign">,</span> 100<span class="sign">)</span><span class="sign">,</span> <span class="keyword">length</span><span class="sign">(</span>Zij<span class="sign">$</span>Zij2<span class="sign">)</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">321 </span>        <span class="sign">}</span>    
<span class="line_number">322 </span>        Zij1times <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>Inf<span class="sign">,</span> <span class="keyword">dim</span><span class="sign">(</span>Zij1<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">323 </span>    <span class="sign">}</span>
<span class="line_number">324 </span>        kmax <span class="sign">&lt;</span><span class="sign">-</span> 100 <span class="comment"># maximum number of events allowed before censoring</span>
<span class="line_number">325 </span>    <span class="comment">## Compute the number of observed events for each individual</span>
<span class="line_number">326 </span>        nevents1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span>  
<span class="line_number">327 </span>    <span class="comment">## Compute the number of observed events for each individual</span>
<span class="line_number">328 </span>        nevents2 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span>  
<span class="line_number">329 </span>        ncovchange <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">330 </span>    <span class="comment">## observed events</span>
<span class="line_number">331 </span>        <span class="keyword">for</span><span class="sign">(</span>ij in 1<span class="sign">:</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span> nevents1<span class="sign">[</span>ij<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span><span class="keyword">cumsum</span><span class="sign">(</span>Rij1<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span> <span class="sign">&lt;</span> Cij<span class="sign">[</span>ij<span class="sign">]</span><span class="sign">)</span> 
<span class="line_number">332 </span>        <span class="keyword">for</span><span class="sign">(</span>ij in 1<span class="sign">:</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span> nevents2<span class="sign">[</span>ij<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span><span class="keyword">cumsum</span><span class="sign">(</span>Rij2<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span> <span class="sign">&lt;</span> Cij<span class="sign">[</span>ij<span class="sign">]</span><span class="sign">)</span> 
<span class="line_number">333 </span>    <span class="comment">## observed covariate changes</span>
<span class="line_number">334 </span>        <span class="keyword">for</span><span class="sign">(</span>ij in 1<span class="sign">:</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span> ncovchange<span class="sign">[</span>ij<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span><span class="keyword">cumsum</span><span class="sign">(</span>Zij1times<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span> <span class="sign">&lt;</span> Cij<span class="sign">[</span>ij<span class="sign">]</span><span class="sign">)</span> 
<span class="line_number">335 </span>        outdata<span class="sign">.</span>matrix <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>nevents1 <span class="sign">+</span> nevents2 <span class="sign">+</span> ncovchange <span class="sign">+</span> 1<span class="sign">)</span><span class="sign">,</span> 10<span class="sign">)</span>
<span class="line_number">336 </span>        outrow <span class="sign">&lt;</span><span class="sign">-</span> 1
<span class="line_number">337 </span>        <span class="comment"># Loop runs over all individuals and generates an Anderson - Gill line</span>
<span class="line_number">338 </span>        <span class="comment"># for each event time that is less than the follow - up time</span>
<span class="line_number">339 </span>        <span class="comment"># Columns: i: Cluster, j: Individual, k: At risk for which event</span>
<span class="line_number">340 </span>    <span class="comment">#   start / stop: Cumulative times, Z: Covariate values, Delta / delta: indicators </span>
<span class="line_number">341 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="comment">!alternating){</span>
<span class="line_number">342 </span>        <span class="keyword">for</span><span class="sign">(</span>i in 1<span class="sign">:</span>m<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">343 </span>            <span class="keyword">for</span><span class="sign">(</span>j in 1<span class="sign">:</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">344 </span>                ij <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">[</span>0<span class="sign">:</span><span class="sign">(</span>i <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">]</span><span class="sign">)</span> <span class="sign">+</span> j
<span class="line_number">345 </span>                ThisFollowTime <span class="sign">&lt;</span><span class="sign">-</span> Cij<span class="sign">[</span>ij<span class="sign">]</span>
<span class="line_number">346 </span>                CumTimes1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">cumsum</span><span class="sign">(</span>Rij1<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">347 </span>                CumTimes2 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">cumsum</span><span class="sign">(</span>Rij2<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">348 </span>                CumTimesZ <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">cumsum</span><span class="sign">(</span>Zij1times<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">349 </span>                CumTimes1 <span class="sign">&lt;</span><span class="sign">-</span> CumTimes1<span class="sign">[</span>CumTimes1 <span class="sign">&lt;</span> ThisFollowTime<span class="sign">]</span>
<span class="line_number">350 </span>                CumTimes2 <span class="sign">&lt;</span><span class="sign">-</span> CumTimes2<span class="sign">[</span>CumTimes2 <span class="sign">&lt;</span> ThisFollowTime<span class="sign">]</span>
<span class="line_number">351 </span>                CumTimesZ <span class="sign">&lt;</span><span class="sign">-</span> CumTimesZ<span class="sign">[</span>CumTimesZ <span class="sign">&lt;</span> ThisFollowTime<span class="sign">]</span>
<span class="line_number">352 </span>                l1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">length</span><span class="sign">(</span>CumTimes1<span class="sign">)</span>
<span class="line_number">353 </span>                l2 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">length</span><span class="sign">(</span>CumTimes2<span class="sign">)</span>
<span class="line_number">354 </span>                lZ <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">length</span><span class="sign">(</span>CumTimesZ<span class="sign">)</span>
<span class="line_number">355 </span>                thisoutdata <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> l1 <span class="sign">+</span> l2 <span class="sign">+</span> lZ <span class="sign">+</span> 1<span class="sign">,</span> 10<span class="sign">)</span>
<span class="line_number">356 </span>                thisoutdata<span class="sign">[</span><span class="sign">,</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> i<span class="sign">;</span>thisoutdata<span class="sign">[</span><span class="sign">,</span> 2<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> j<span class="sign">;</span>
<span class="line_number">357 </span>                thisoutdata<span class="sign">[</span><span class="sign">,</span> 6<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>CumTimes1<span class="sign">,</span> CumTimes2<span class="sign">,</span> CumTimesZ<span class="sign">,</span> ThisFollowTime<span class="sign">)</span>
<span class="line_number">358 </span>                thisoutdata<span class="sign">[</span><span class="sign">,</span> 7<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span><span class="keyword">rep</span><span class="sign">(</span>1<span class="sign">,</span> l1<span class="sign">)</span><span class="sign">,</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> l2 <span class="sign">+</span> lZ <span class="sign">+</span> 1<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">359 </span>                thisoutdata<span class="sign">[</span><span class="sign">,</span> 8<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span><span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> l1<span class="sign">)</span><span class="sign">,</span> <span class="keyword">rep</span><span class="sign">(</span>1<span class="sign">,</span> l2<span class="sign">)</span><span class="sign">,</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> lZ <span class="sign">+</span> 1<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">360 </span>                thisoutdata<span class="sign">[</span><span class="sign">,</span> 9<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span><span class="keyword">rep</span><span class="sign">(</span>NA<span class="sign">,</span> l1 <span class="sign">+</span> l2<span class="sign">)</span><span class="sign">,</span> Zij1<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">(</span>lZ <span class="sign">&gt;</span> 0<span class="sign">)</span> <span class="sign">*</span> <span class="sign">(</span>1<span class="sign">:</span>lZ<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span>
<span class="line_number">361 </span>                    Zij1<span class="sign">[</span>ij<span class="sign">,</span> min<span class="sign">(</span><span class="keyword">which</span><span class="sign">(</span><span class="keyword">cumsum</span><span class="sign">(</span>Zij1times<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span> <span class="sign">&gt;</span> ThisFollowTime<span class="sign">)</span><span class="sign">)</span><span class="sign">]</span><span class="sign">)</span>
<span class="line_number">362 </span>                thisoutdata<span class="sign">[</span><span class="sign">,</span> 10<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span><span class="keyword">rep</span><span class="sign">(</span>NA<span class="sign">,</span> l1 <span class="sign">+</span> l2<span class="sign">)</span><span class="sign">,</span> Zij2<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">(</span>lZ <span class="sign">&gt;</span> 0<span class="sign">)</span> <span class="sign">*</span> <span class="sign">(</span>1<span class="sign">:</span>lZ<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span>
<span class="line_number">363 </span>                    Zij2<span class="sign">[</span>ij<span class="sign">,</span> min<span class="sign">(</span><span class="keyword">which</span><span class="sign">(</span><span class="keyword">cumsum</span><span class="sign">(</span>Zij1times<span class="sign">[</span>ij<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span> <span class="sign">&gt;</span> ThisFollowTime<span class="sign">)</span><span class="sign">)</span><span class="sign">]</span><span class="sign">)</span>
<span class="line_number">364 </span>                thisoutdata <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>thisoutdata<span class="sign">[</span>order<span class="sign">(</span>thisoutdata<span class="sign">[</span><span class="sign">,</span> 6<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span> <span class="sign">]</span><span class="sign">,</span>
<span class="line_number">365 </span>                    <span class="keyword">dim</span><span class="sign">(</span>thisoutdata<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> <span class="keyword">dim</span><span class="sign">(</span>thisoutdata<span class="sign">)</span><span class="sign">[</span>2<span class="sign">]</span><span class="sign">)</span>    
<span class="line_number">366 </span>                thisoutdata<span class="sign">[</span><span class="sign">,</span> 3<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">cumsum</span><span class="sign">(</span>c<span class="sign">(</span>1<span class="sign">,</span> thisoutdata<span class="sign">[</span><span class="sign">,</span> 7<span class="sign">]</span> <span class="sign">+</span> 
<span class="line_number">367 </span>                    thisoutdata<span class="sign">[</span><span class="sign">,</span> 8<span class="sign">]</span><span class="sign">)</span><span class="sign">)</span><span class="sign">[</span> <span class="sign">-</span> <span class="sign">(</span><span class="keyword">dim</span><span class="sign">(</span>thisoutdata<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span> <span class="sign">+</span> 1<span class="sign">)</span><span class="sign">]</span>     
<span class="line_number">368 </span>                <span class="keyword">for</span><span class="sign">(</span>ind in <span class="sign">(</span><span class="keyword">dim</span><span class="sign">(</span>thisoutdata<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">)</span><span class="sign">:</span>1<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">369 </span>                    <span class="keyword">if</span><span class="sign">(</span><span class="comment">!is.na(thisoutdata[ind, 9])) thisZ1 &lt;- thisoutdata[ind, 9] </span>
<span class="line_number">370 </span>                    <span class="keyword">else</span> thisoutdata<span class="sign">[</span>ind<span class="sign">,</span> 9<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> thisZ1
<span class="line_number">371 </span>                    <span class="keyword">if</span><span class="sign">(</span><span class="comment">!is.na(thisoutdata[ind, 10])) thisZ2 &lt;- thisoutdata[ind, 10] </span>
<span class="line_number">372 </span>                    <span class="keyword">else</span> thisoutdata<span class="sign">[</span>ind<span class="sign">,</span> 10<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> thisZ2
<span class="line_number">373 </span>                    k <span class="sign">&lt;</span><span class="sign">-</span> thisoutdata<span class="sign">[</span>ind<span class="sign">,</span> 3<span class="sign">]</span>
<span class="line_number">374 </span>                    thisoutdata<span class="sign">[</span>ind<span class="sign">,</span> 4<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <a href="#robo66">L</a><span class="sign">(</span>i<span class="sign">,</span> j<span class="sign">,</span> k<span class="sign">,</span> Zij1<span class="sign">[</span>ij<span class="sign">,</span> k<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">375 </span>                    <span class="keyword">if</span><span class="sign">(</span>ind <span class="sign">&gt;</span> 1<span class="sign">)</span> thisoutdata<span class="sign">[</span>ind<span class="sign">,</span> 5<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> thisoutdata<span class="sign">[</span>ind <span class="sign">-</span> 1<span class="sign">,</span> 6<span class="sign">]</span>
<span class="line_number">376 </span>                <span class="sign">}</span>
<span class="line_number">377 </span>                newoutrow <span class="sign">&lt;</span><span class="sign">-</span> outrow <span class="sign">+</span> <span class="keyword">dim</span><span class="sign">(</span>thisoutdata<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span>
<span class="line_number">378 </span>                outdata<span class="sign">.</span>matrix<span class="sign">[</span>outrow<span class="sign">:</span><span class="sign">(</span>newoutrow <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">,</span> <span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> thisoutdata
<span class="line_number">379 </span>                outrow <span class="sign">&lt;</span><span class="sign">-</span> newoutrow
<span class="line_number">380 </span>            <span class="sign">}</span>
<span class="line_number">381 </span>        <span class="sign">}</span>
<span class="line_number">382 </span>    <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">383 </span>        <span class="keyword">for</span><span class="sign">(</span>i in 1<span class="sign">:</span>m<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">384 </span>            <span class="keyword">for</span><span class="sign">(</span>j in 1<span class="sign">:</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">385 </span>                ij <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">[</span>0<span class="sign">:</span><span class="sign">(</span>i <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">]</span><span class="sign">)</span> <span class="sign">+</span> j
<span class="line_number">386 </span>                ThisFollowTime <span class="sign">&lt;</span><span class="sign">-</span> Cij<span class="sign">[</span>ij<span class="sign">]</span>
<span class="line_number">387 </span>                CumTime <span class="sign">&lt;</span><span class="sign">-</span> 0
<span class="line_number">388 </span>                k <span class="sign">&lt;</span><span class="sign">-</span> 1<span class="sign">;</span>eventct <span class="sign">&lt;</span><span class="sign">-</span> 1
<span class="line_number">389 </span>                <span class="keyword">while</span><span class="sign">(</span>CumTime <span class="sign">&lt;</span> ThisFollowTime<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">390 </span>                    <span class="keyword">if</span><span class="sign">(</span><span class="sign">(</span>CumTime <span class="sign">+</span> Rij1<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">)</span> <span class="sign">&lt;</span> ThisFollowTime<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">391 </span>                        thisoutdata <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>i<span class="sign">,</span> j<span class="sign">,</span> k<span class="sign">,</span> <a href="#robo66">L</a><span class="sign">(</span>i<span class="sign">,</span> j<span class="sign">,</span> k<span class="sign">,</span> Zij1<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">392 </span>                            CumTime<span class="sign">,</span> CumTime <span class="sign">+</span> Rij1<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">,</span> 1<span class="sign">,</span> 0<span class="sign">,</span> 
<span class="line_number">393 </span>                            Zij1<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">,</span> Zij2<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">394 </span>                        CumTime <span class="sign">&lt;</span><span class="sign">-</span> CumTime <span class="sign">+</span> Rij1<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span>
<span class="line_number">395 </span>                        outdata<span class="sign">.</span>matrix<span class="sign">[</span>outrow<span class="sign">,</span> <span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> thisoutdata
<span class="line_number">396 </span>                        k <span class="sign">&lt;</span><span class="sign">-</span> k <span class="sign">+</span> 1<span class="sign">;</span>outrow <span class="sign">&lt;</span><span class="sign">-</span> outrow <span class="sign">+</span> 1
<span class="line_number">397 </span>                    <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">398 </span>                        thisoutdata <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>i<span class="sign">,</span> j<span class="sign">,</span> k<span class="sign">,</span> <a href="#robo66">L</a><span class="sign">(</span>i<span class="sign">,</span> j<span class="sign">,</span> k<span class="sign">,</span> Zij1<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">399 </span>                            CumTime<span class="sign">,</span> ThisFollowTime<span class="sign">,</span> 0<span class="sign">,</span> 0<span class="sign">,</span> Zij1<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">,</span>
<span class="line_number">400 </span>                            Zij2<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">401 </span>                        CumTime <span class="sign">&lt;</span><span class="sign">-</span> ThisFollowTime
<span class="line_number">402 </span>                        outdata<span class="sign">.</span>matrix<span class="sign">[</span>outrow<span class="sign">,</span> <span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> thisoutdata
<span class="line_number">403 </span>                        k <span class="sign">&lt;</span><span class="sign">-</span> k <span class="sign">+</span> 1<span class="sign">;</span>outrow <span class="sign">&lt;</span><span class="sign">-</span> outrow <span class="sign">+</span> 1
<span class="line_number">404 </span>                    <span class="sign">}</span>
<span class="line_number">405 </span>                    <span class="keyword">if</span><span class="sign">(</span><span class="sign">(</span>CumTime <span class="sign">+</span> Rij2<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">)</span> <span class="sign">&lt;</span> ThisFollowTime<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">406 </span>                        thisoutdata <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>i<span class="sign">,</span> j<span class="sign">,</span> k<span class="sign">,</span> <a href="#robo66">L</a><span class="sign">(</span>i<span class="sign">,</span> j<span class="sign">,</span> k<span class="sign">,</span> Zij2<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">407 </span>                            CumTime<span class="sign">,</span> CumTime <span class="sign">+</span> Rij2<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">,</span> 0<span class="sign">,</span> 1<span class="sign">,</span>
<span class="line_number">408 </span>                            Zij1<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">,</span> Zij2<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">409 </span>                        CumTime <span class="sign">&lt;</span><span class="sign">-</span> CumTime <span class="sign">+</span> Rij2<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span>
<span class="line_number">410 </span>                        outdata<span class="sign">.</span>matrix<span class="sign">[</span>outrow<span class="sign">,</span> <span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> thisoutdata
<span class="line_number">411 </span>                        k <span class="sign">&lt;</span><span class="sign">-</span> k <span class="sign">+</span> 1<span class="sign">;</span>outrow <span class="sign">&lt;</span><span class="sign">-</span> outrow <span class="sign">+</span> 1
<span class="line_number">412 </span>                    <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">413 </span>                        <span class="keyword">if</span><span class="sign">(</span>CumTime <span class="sign">&lt;</span> ThisFollowTime<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">414 </span>                            thisoutdata <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>i<span class="sign">,</span> j<span class="sign">,</span> k<span class="sign">,</span> <a href="#robo66">L</a><span class="sign">(</span>i<span class="sign">,</span> j<span class="sign">,</span> k<span class="sign">,</span> Zij2<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">415 </span>                                CumTime<span class="sign">,</span> ThisFollowTime<span class="sign">,</span> 0<span class="sign">,</span> 0<span class="sign">,</span> Zij1<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">,</span>
<span class="line_number">416 </span>                                Zij2<span class="sign">[</span>ij<span class="sign">,</span> eventct<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">417 </span>                            CumTime <span class="sign">&lt;</span><span class="sign">-</span> ThisFollowTime
<span class="line_number">418 </span>                            outdata<span class="sign">.</span>matrix<span class="sign">[</span>outrow<span class="sign">,</span> <span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> thisoutdata
<span class="line_number">419 </span>                            k <span class="sign">&lt;</span><span class="sign">-</span> k <span class="sign">+</span> 1<span class="sign">;</span>outrow <span class="sign">&lt;</span><span class="sign">-</span> outrow <span class="sign">+</span> 1
<span class="line_number">420 </span>                        <span class="sign">}</span>
<span class="line_number">421 </span>                    <span class="sign">}</span>
<span class="line_number">422 </span>                    eventct <span class="sign">&lt;</span><span class="sign">-</span> eventct <span class="sign">+</span> 1
<span class="line_number">423 </span>                <span class="sign">}</span>
<span class="line_number">424 </span>            <span class="sign">}</span>
<span class="line_number">425 </span>        <span class="sign">}</span>
<span class="line_number">426 </span>    
<span class="line_number">427 </span>    <span class="sign">}</span>
<span class="line_number">428 </span>        outdata <span class="sign">&lt;</span><span class="sign">-</span> as<span class="sign">.</span>data<span class="sign">.</span>frame<span class="sign">(</span>outdata<span class="sign">.</span>matrix<span class="sign">[</span>1<span class="sign">:</span><span class="sign">(</span>outrow <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">429 </span>        <span class="keyword">colnames</span><span class="sign">(</span>outdata<span class="sign">)</span> <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span><span class="quote">"i"</span><span class="sign">,</span> <span class="quote">"j"</span><span class="sign">,</span> <span class="quote">"k"</span><span class="sign">,</span> <span class="quote">"r"</span><span class="sign">,</span> <span class="quote">"start"</span><span class="sign">,</span> <span class="quote">"stop"</span><span class="sign">,</span>
<span class="line_number">430 </span>                            <span class="quote">"delta"</span><span class="sign">,</span> <span class="quote">"Delta"</span><span class="sign">,</span> <span class="quote">"Z1"</span><span class="sign">,</span> <span class="quote">"Z2"</span><span class="sign">)</span>
<span class="line_number">431 </span>        <span class="keyword">return</span><span class="sign">(</span>outdata<span class="sign">)</span>
<span class="line_number">432 </span><span class="sign">}</span>
</pre>

<hr />
<a name="simulation2fgeneratecensoring"></a>
<a name="robo61"></a><h2>simulation/generatecensoring [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo5">simulation</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>generatecensoring</strong> --- generate censoring times
</pre>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">671 </span><strong>generatecensoring</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>m<span class="sign">,</span> Ji<span class="sign">,</span> lambda0c<span class="sign">,</span> gamweibc<span class="sign">)</span>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">674 </span><span class="sign">{</span>
<span class="line_number">675 </span>    <span class="comment">### Random censoring</span>
<span class="line_number">676 </span>    C <span class="sign">&lt;</span><span class="sign">-</span> rweibull<span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">,</span> shape <span class="sign">=</span> gamweibc<span class="sign">,</span> scale <span class="sign">=</span> lambda0c<span class="sign">^</span><span class="sign">(</span><span class="sign">-</span>1 <span class="sign">/</span> gamweibc<span class="sign">)</span><span class="sign">)</span>    
<span class="line_number">677 </span><span class="sign">}</span>
</pre>

<hr />
<a name="simulation2fgeneratecovariate"></a>
<a name="robo62"></a><h2>simulation/generatecovariate [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo5">simulation</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>generatecovariate</strong>
</pre>
<p class="item_name">FUNCTION</p>
<p>    Generates a single covariate, Normal with a given mean and variance.
    Old code to generate multiple covariates or time - dependent covariates 
    has been removed.
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">563 </span><strong>generatecovariate</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>params<span class="sign">)</span>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">566 </span><span class="sign">{</span>
<span class="line_number">567 </span>    m <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>m<span class="sign">;</span>Ji <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>Ji<span class="sign">;</span>timedep <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>timedep
<span class="line_number">568 </span>    Z1mean <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>Z1mean<span class="sign">;</span>Z1var <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>Z1var
<span class="line_number">569 </span>    gamweib <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>gamweib<span class="sign">;</span>lambda0 <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>lambda0<span class="sign">;</span>
<span class="line_number">570 </span>    <span class="keyword">if</span><span class="sign">(</span>timedep<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">571 </span>        Zij1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rnorm</span><span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span> <span class="sign">*</span> 100<span class="sign">,</span> Z1mean<span class="sign">,</span> Z1var<span class="sign">)</span><span class="sign">;</span><span class="keyword">dim</span><span class="sign">(</span>Zij1<span class="sign">)</span> <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">572 </span>        Zij1times <span class="sign">&lt;</span><span class="sign">-</span> rweibull<span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span> <span class="sign">*</span> 100<span class="sign">,</span> shape <span class="sign">=</span> gamweib<span class="sign">,</span>
<span class="line_number">573 </span>            scale <span class="sign">=</span> lambda0<span class="sign">^</span><span class="sign">(</span><span class="sign">-</span>1 <span class="sign">/</span> gamweib<span class="sign">)</span><span class="sign">)</span><span class="sign">;</span><span class="keyword">dim</span><span class="sign">(</span>Zij1times<span class="sign">)</span> <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">574 </span>        <span class="keyword">return</span><span class="sign">(</span><span class="keyword">list</span><span class="sign">(</span>Zij1 <span class="sign">=</span> Zij1<span class="sign">,</span> Zij1times <span class="sign">=</span> Zij1times<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">575 </span>    <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">576 </span>        Zij1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rnorm</span><span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">,</span> Z1mean<span class="sign">,</span> Z1var<span class="sign">)</span>
<span class="line_number">577 </span>        <span class="keyword">return</span><span class="sign">(</span>Zij1<span class="sign">)</span>
<span class="line_number">578 </span>    <span class="sign">}</span>
<span class="line_number">579 </span><span class="sign">}</span>
</pre>

<hr />
<a name="simulation2fgeneratefrailty"></a>
<a name="robo63"></a><h2>simulation/generatefrailty [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo5">simulation</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>generatefrailty</strong> --- simulate frailties
</pre>
<p class="item_name">FUNCTION</p>
<p>    Generates simulated frailties by different methods depending on the
    distribution chosen.
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">447 </span><strong>generatefrailty</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>type <span class="sign">=</span> <span class="quote">"lognormal"</span><span class="sign">,</span> params<span class="sign">)</span>
</pre>
<p class="item_name">INPUTS</p>
<pre>    type    distribution string
    params  cluster information and dispersion parameters
</pre>
<p class="item_name">OUTPUTS</p>
<pre>    Ui, Uij, Vi, Vij vectors
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">450 </span><span class="sign">{</span>
<span class="line_number">451 </span>    Ui <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>1<span class="sign">;</span>Vi <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>1<span class="sign">;</span>Uij <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>1<span class="sign">;</span>Vij <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>1<span class="sign">;</span>
<span class="line_number">452 </span>    m <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>m<span class="sign">;</span>Ji <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>Ji
<span class="line_number">453 </span>    sigma2 <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>sigma2<span class="sign">;</span>sigma2d <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>sigma2d<span class="sign">;</span>
<span class="line_number">454 </span>    nu2 <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>nu2<span class="sign">;</span> nu2d <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>nu2d<span class="sign">;</span> theta <span class="sign">&lt;</span><span class="sign">-</span> params<span class="sign">$</span>theta
<span class="line_number">455 </span>    <span class="comment"># Occasionally, trivariate reduction or gaussian frailties can be negative, </span>
<span class="line_number">456 </span>    <span class="comment"># continue generating until this is no longer the case.</span>
<span class="line_number">457 </span>    <span class="keyword">while</span><span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>Ui <span class="sign">&lt;</span> 0<span class="sign">)</span> <span class="sign">+</span> <span class="keyword">sum</span><span class="sign">(</span>Vi <span class="sign">&lt;</span> 0<span class="sign">)</span> <span class="sign">+</span> <span class="keyword">sum</span><span class="sign">(</span>Uij <span class="sign">&lt;</span> 0<span class="sign">)</span> <span class="sign">+</span> <span class="keyword">sum</span><span class="sign">(</span>Vij <span class="sign">&lt;</span> 0<span class="sign">)</span> <span class="sign">&gt;</span> 0<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">458 </span>        Ui <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span><span class="sign">;</span> Vi <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span>
<span class="line_number">459 </span>        Uij <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span><span class="sign">;</span> Vij <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">460 </span>        <span class="comment"># Cumulative sum of number of cluster individuals</span>
<span class="line_number">461 </span>        Jicum <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>1<span class="sign">,</span> <span class="keyword">cumsum</span><span class="sign">(</span>Ji<span class="sign">)</span> <span class="sign">+</span> 1<span class="sign">)</span> 
<span class="line_number">462 </span>        <span class="keyword">if</span><span class="sign">(</span>type <span class="sign">=</span><span class="sign">=</span> <span class="quote">"gamma"</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">463 </span>            <span class="comment">#! Gamma subject - level frailties are generated by trivariate reduction, as follows:</span>
<span class="line_number">464 </span>             <span class="keyword">for</span> <span class="sign">(</span>i in 1<span class="sign">:</span>m<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">465 </span>                <span class="comment"># Ensure that conditions for trivariate reduction are met</span>
<span class="line_number">466 </span>                <span class="keyword">while</span><span class="sign">(</span>Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">=</span> theta <span class="sign">/</span> nu2d <span class="sign">|</span> Vi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">=</span> theta <span class="sign">/</span> nu2<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">467 </span>                    <span class="comment"># Mean 1, variance sigma2</span>
<span class="line_number">468 </span>                    Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rgamma</span><span class="sign">(</span>1<span class="sign">,</span> shape <span class="sign">=</span> 1 <span class="sign">/</span> sigma2<span class="sign">,</span> scale <span class="sign">=</span> sigma2<span class="sign">)</span>  
<span class="line_number">469 </span>                    <span class="comment"># Mean 1, variance sigma2d</span>
<span class="line_number">470 </span>                    Vi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rgamma</span><span class="sign">(</span>1<span class="sign">,</span> shape <span class="sign">=</span> 1 <span class="sign">/</span> sigma2d<span class="sign">,</span> scale <span class="sign">=</span> sigma2d<span class="sign">)</span>  
<span class="line_number">471 </span>                <span class="sign">}</span>
<span class="line_number">472 </span>                Y1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rgamma</span><span class="sign">(</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> shape <span class="sign">=</span> Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">/</span> nu2 <span class="sign">-</span> theta <span class="sign">/</span> <span class="sign">(</span>nu2 <span class="sign">*</span> nu2d<span class="sign">)</span><span class="sign">,</span> scale <span class="sign">=</span> 1<span class="sign">)</span>
<span class="line_number">473 </span>                Y2 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rgamma</span><span class="sign">(</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> shape <span class="sign">=</span> Vi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">/</span> nu2d <span class="sign">-</span> theta <span class="sign">/</span> <span class="sign">(</span>nu2 <span class="sign">*</span> nu2d<span class="sign">)</span><span class="sign">,</span> scale <span class="sign">=</span> 1<span class="sign">)</span>
<span class="line_number">474 </span>                Y3 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rgamma</span><span class="sign">(</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> shape <span class="sign">=</span> theta <span class="sign">/</span> <span class="sign">(</span>nu2 <span class="sign">*</span> nu2d<span class="sign">)</span><span class="sign">,</span> scale <span class="sign">=</span> 1<span class="sign">)</span>
<span class="line_number">475 </span>                <span class="keyword">if</span><span class="sign">(</span>theta <span class="sign">=</span><span class="sign">=</span> 0<span class="sign">)</span><span class="sign">{</span> Y3 <span class="sign">&lt;</span><span class="sign">-</span> 0 <span class="sign">}</span>
<span class="line_number">476 </span>                Uij<span class="sign">[</span>Jicum<span class="sign">[</span>i<span class="sign">]</span><span class="sign">:</span><span class="sign">(</span>Jicum<span class="sign">[</span>i <span class="sign">+</span> 1<span class="sign">]</span> <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> nu2 <span class="sign">*</span> <span class="sign">(</span>Y1 <span class="sign">+</span> Y3<span class="sign">)</span>
<span class="line_number">477 </span>                Vij<span class="sign">[</span>Jicum<span class="sign">[</span>i<span class="sign">]</span><span class="sign">:</span><span class="sign">(</span>Jicum<span class="sign">[</span>i <span class="sign">+</span> 1<span class="sign">]</span> <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> nu2d <span class="sign">*</span> <span class="sign">(</span>Y2 <span class="sign">+</span> Y3<span class="sign">)</span>
<span class="line_number">478 </span>            <span class="sign">}</span>
<span class="line_number">479 </span>        <span class="sign">}</span>
<span class="line_number">480 </span>        <span class="keyword">if</span><span class="sign">(</span>type <span class="sign">=</span><span class="sign">=</span> <span class="quote">"gaussian"</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">481 </span>            <span class="comment">#!For Gaussian frailties, the cluster - level frailties are generated as iid Normals,</span>
<span class="line_number">482 </span>            <span class="comment">#!and given these, the subject - level frailties are generated with the covariance matrix</span>
<span class="line_number">483 </span>            <span class="comment">#!above. The code checks that the covariance matrix is positive definite, which is not</span>
<span class="line_number">484 </span>            <span class="comment">#!always assured.</span>
<span class="line_number">485 </span>            <span class="keyword">for</span> <span class="sign">(</span>i in 1<span class="sign">:</span>m<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">486 </span>                eig <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>1
<span class="line_number">487 </span>                <span class="keyword">while</span><span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>eig <span class="sign">&lt;</span> 0<span class="sign">)</span> <span class="sign">&gt;</span> 0<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">488 </span>                    Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rnorm</span><span class="sign">(</span>1<span class="sign">,</span> mean <span class="sign">=</span> 1<span class="sign">,</span> sd <span class="sign">=</span> <span class="keyword">sqrt</span><span class="sign">(</span>sigma2<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">489 </span>                    Vi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rnorm</span><span class="sign">(</span>1<span class="sign">,</span> mean <span class="sign">=</span> 1<span class="sign">,</span> sd <span class="sign">=</span> <span class="keyword">sqrt</span><span class="sign">(</span>sigma2d<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">490 </span>                    covmat <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>c<span class="sign">(</span>Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> nu2<span class="sign">,</span> theta<span class="sign">,</span> theta<span class="sign">,</span> Vi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> nu2d<span class="sign">)</span><span class="sign">,</span> 2<span class="sign">,</span> 2<span class="sign">)</span>
<span class="line_number">491 </span>                    eig <span class="sign">&lt;</span><span class="sign">-</span> eigen<span class="sign">(</span>covmat<span class="sign">)</span><span class="sign">$</span>values
<span class="line_number">492 </span>                    <span class="keyword">if</span><span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>eig <span class="sign">&lt;</span> 0<span class="sign">)</span> <span class="sign">&gt;</span> 0<span class="sign">)</span> print<span class="sign">(</span><span class="quote">"hello"</span><span class="sign">)</span>
<span class="line_number">493 </span>                <span class="sign">}</span>
<span class="line_number">494 </span>                UV <span class="sign">&lt;</span><span class="sign">-</span> mvrnorm<span class="sign">(</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> c<span class="sign">(</span>Ui<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> Vi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span> covmat<span class="sign">)</span>
<span class="line_number">495 </span>                Uij<span class="sign">[</span>Jicum<span class="sign">[</span>i<span class="sign">]</span><span class="sign">:</span><span class="sign">(</span>Jicum<span class="sign">[</span>i <span class="sign">+</span> 1<span class="sign">]</span> <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> UV<span class="sign">[</span><span class="sign">,</span> 1<span class="sign">]</span>
<span class="line_number">496 </span>                Vij<span class="sign">[</span>Jicum<span class="sign">[</span>i<span class="sign">]</span><span class="sign">:</span><span class="sign">(</span>Jicum<span class="sign">[</span>i <span class="sign">+</span> 1<span class="sign">]</span> <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> UV<span class="sign">[</span><span class="sign">,</span> 2<span class="sign">]</span>
<span class="line_number">497 </span>            <span class="sign">}</span>
<span class="line_number">498 </span>        <span class="sign">}</span>
<span class="line_number">499 </span>        <span class="keyword">if</span><span class="sign">(</span>type <span class="sign">=</span><span class="sign">=</span> <span class="quote">"lognormal"</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">500 </span>            <span class="keyword">for</span> <span class="sign">(</span>i in 1<span class="sign">:</span>m<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">501 </span>                eig <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>1
<span class="line_number">502 </span>                <span class="keyword">while</span><span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>eig <span class="sign">&lt;</span> 0<span class="sign">)</span> <span class="sign">&gt;</span> 0<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">503 </span>                    <span class="comment"># Mean 1, variance sigma2                </span>
<span class="line_number">504 </span>                    Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">exp</span><span class="sign">(</span><span class="keyword">rnorm</span><span class="sign">(</span>1<span class="sign">,</span> log<span class="sign">(</span>1 <span class="sign">/</span> <span class="keyword">sqrt</span><span class="sign">(</span>1 <span class="sign">+</span> sigma2<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span> <span class="keyword">sqrt</span><span class="sign">(</span>log<span class="sign">(</span>1 <span class="sign">+</span> sigma2<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span> <span class="sign">)</span> 
<span class="line_number">505 </span>                    <span class="comment"># Mean 1, variance sigma2d               </span>
<span class="line_number">506 </span>                    Vi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">exp</span><span class="sign">(</span><span class="keyword">rnorm</span><span class="sign">(</span>1<span class="sign">,</span> log<span class="sign">(</span>1 <span class="sign">/</span> <span class="keyword">sqrt</span><span class="sign">(</span>1 <span class="sign">+</span> sigma2d<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span> <span class="keyword">sqrt</span><span class="sign">(</span>log<span class="sign">(</span>1 <span class="sign">+</span> sigma2d<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span> <span class="sign">)</span> 
<span class="line_number">507 </span>                    muprime <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>log<span class="sign">(</span>Ui<span class="sign">[</span>i<span class="sign">]</span><span class="sign">^</span>2 <span class="sign">/</span> <span class="keyword">sqrt</span><span class="sign">(</span>Ui<span class="sign">[</span>i<span class="sign">]</span><span class="sign">^</span>2 <span class="sign">+</span> Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> nu2<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">508 </span>                        log<span class="sign">(</span>Vi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">^</span>2 <span class="sign">/</span> <span class="keyword">sqrt</span><span class="sign">(</span>Vi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">^</span>2 <span class="sign">+</span> Vi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> nu2d<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span>
<span class="line_number">509 </span>                    covmat <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> 2<span class="sign">,</span> 2<span class="sign">)</span>
<span class="line_number">510 </span>                    covmat<span class="sign">[</span>1<span class="sign">,</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> log<span class="sign">(</span>1 <span class="sign">+</span> Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> nu2 <span class="sign">/</span> Ui<span class="sign">[</span>i<span class="sign">]</span><span class="sign">^</span>2<span class="sign">)</span>
<span class="line_number">511 </span>                    covmat<span class="sign">[</span>1<span class="sign">,</span> 2<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> log<span class="sign">(</span>1 <span class="sign">+</span> theta <span class="sign">/</span> Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">/</span> Vi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">512 </span>                    covmat<span class="sign">[</span>2<span class="sign">,</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> log<span class="sign">(</span>1 <span class="sign">+</span> theta <span class="sign">/</span> Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">/</span> Vi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">513 </span>                    covmat<span class="sign">[</span>2<span class="sign">,</span> 2<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> log<span class="sign">(</span>1 <span class="sign">+</span> nu2d <span class="sign">*</span> Vi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">/</span> Vi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">^</span>2<span class="sign">)</span>
<span class="line_number">514 </span>                    eig <span class="sign">&lt;</span><span class="sign">-</span> eigen<span class="sign">(</span>covmat<span class="sign">)</span><span class="sign">$</span>values
<span class="line_number">515 </span>                <span class="sign">}</span>
<span class="line_number">516 </span>                UV <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>mvrnorm<span class="sign">(</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> muprime<span class="sign">,</span> covmat<span class="sign">)</span><span class="sign">,</span> Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> 2<span class="sign">)</span>
<span class="line_number">517 </span>                Uij<span class="sign">[</span>Jicum<span class="sign">[</span>i<span class="sign">]</span><span class="sign">:</span><span class="sign">(</span>Jicum<span class="sign">[</span>i <span class="sign">+</span> 1<span class="sign">]</span> <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">exp</span><span class="sign">(</span>UV<span class="sign">[</span><span class="sign">,</span> 1<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">518 </span>                Vij<span class="sign">[</span>Jicum<span class="sign">[</span>i<span class="sign">]</span><span class="sign">:</span><span class="sign">(</span>Jicum<span class="sign">[</span>i <span class="sign">+</span> 1<span class="sign">]</span> <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">exp</span><span class="sign">(</span>UV<span class="sign">[</span><span class="sign">,</span> 2<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">519 </span>            <span class="sign">}</span>
<span class="line_number">520 </span>        <span class="sign">}</span>
<span class="line_number">521 </span>        <span class="keyword">if</span><span class="sign">(</span>type <span class="sign">=</span><span class="sign">=</span> <span class="quote">"lognormperm"</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">522 </span>            genlognormal <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>n<span class="sign">,</span> mu<span class="sign">,</span> sigma2<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">523 </span>                sigma2prime <span class="sign">&lt;</span><span class="sign">-</span> log<span class="sign">(</span>1 <span class="sign">+</span> sigma2 <span class="sign">/</span> mu<span class="sign">^</span>2<span class="sign">)</span>        
<span class="line_number">524 </span>                muprime <span class="sign">&lt;</span><span class="sign">-</span> log<span class="sign">(</span>mu<span class="sign">)</span> <span class="sign">-</span> 1 <span class="sign">/</span> 2 <span class="sign">*</span> sigma2prime
<span class="line_number">525 </span>                <span class="keyword">return</span><span class="sign">(</span>rlnorm<span class="sign">(</span>n<span class="sign">,</span> meanlog <span class="sign">=</span> muprime<span class="sign">,</span> sdlog <span class="sign">=</span> <span class="keyword">sqrt</span><span class="sign">(</span>sigma2prime<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span>            
<span class="line_number">526 </span>            <span class="sign">}</span>
<span class="line_number">527 </span>            correlate <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>x<span class="sign">,</span> y<span class="sign">,</span> covar<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">528 </span>                sorttop <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>x<span class="sign">,</span> pct<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">529 </span>                     nsort <span class="sign">&lt;</span><span class="sign">-</span> round<span class="sign">(</span><span class="keyword">length</span><span class="sign">(</span>x<span class="sign">)</span> <span class="sign">*</span> pct<span class="sign">)</span>
<span class="line_number">530 </span>                     <span class="keyword">if</span><span class="sign">(</span>nsort <span class="sign">&lt;</span> 2<span class="sign">)</span> <span class="keyword">return</span><span class="sign">(</span>x<span class="sign">)</span>
<span class="line_number">531 </span>                     <span class="keyword">if</span><span class="sign">(</span>nsort <span class="sign">=</span><span class="sign">=</span> <span class="keyword">length</span><span class="sign">(</span>x<span class="sign">)</span><span class="sign">)</span> <span class="keyword">return</span><span class="sign">(</span>sort<span class="sign">(</span>x<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">532 </span>                     <span class="keyword">return</span><span class="sign">(</span>c<span class="sign">(</span>sort<span class="sign">(</span>x<span class="sign">[</span>1<span class="sign">:</span>nsort<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span> x<span class="sign">[</span><span class="sign">(</span>nsort <span class="sign">+</span> 1<span class="sign">)</span><span class="sign">:</span><span class="keyword">length</span><span class="sign">(</span>x<span class="sign">)</span><span class="sign">]</span><span class="sign">)</span><span class="sign">)</span>
<span class="line_number">533 </span>                <span class="sign">}</span>
<span class="line_number">534 </span>                <span class="keyword">if</span><span class="sign">(</span><span class="keyword">length</span><span class="sign">(</span>x<span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> 1<span class="sign">)</span> <span class="keyword">return</span><span class="sign">(</span><span class="keyword">list</span><span class="sign">(</span>x <span class="sign">=</span> x<span class="sign">,</span> y <span class="sign">=</span> y<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">535 </span>                pctopt <span class="sign">&lt;</span><span class="sign">-</span> optimize<span class="sign">(</span><span class="keyword">function</span><span class="sign">(</span>pct<span class="sign">,</span> target<span class="sign">,</span> x<span class="sign">,</span> y<span class="sign">)</span> <span class="sign">(</span>cov<span class="sign">(</span>sorttop<span class="sign">(</span>x<span class="sign">,</span> pct<span class="sign">)</span><span class="sign">,</span> sorttop<span class="sign">(</span>y<span class="sign">,</span> pct<span class="sign">)</span><span class="sign">)</span> <span class="sign">-</span> target<span class="sign">)</span><span class="sign">^</span>2<span class="sign">,</span> interval <span class="sign">=</span> c<span class="sign">(</span>0<span class="sign">,</span> 1<span class="sign">)</span><span class="sign">,</span> target <span class="sign">=</span> covar<span class="sign">,</span> x <span class="sign">=</span> x<span class="sign">,</span> y <span class="sign">=</span> y<span class="sign">)</span><span class="sign">$</span>minimum    
<span class="line_number">536 </span>                <span class="keyword">cat</span><span class="sign">(</span><span class="quote">" "</span><span class="sign">,</span> pctopt<span class="sign">)</span>
<span class="line_number">537 </span>                <span class="keyword">return</span><span class="sign">(</span><span class="keyword">list</span><span class="sign">(</span>x <span class="sign">=</span> sorttop<span class="sign">(</span>x<span class="sign">,</span> pctopt<span class="sign">)</span><span class="sign">,</span> y <span class="sign">=</span> sorttop<span class="sign">(</span>y<span class="sign">,</span> pctopt<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span>
<span class="line_number">538 </span>            <span class="sign">}</span>
<span class="line_number">539 </span>            <span class="keyword">for</span><span class="sign">(</span>i in 1<span class="sign">:</span>m<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">540 </span>                Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">exp</span><span class="sign">(</span><span class="keyword">rnorm</span><span class="sign">(</span>1<span class="sign">,</span> log<span class="sign">(</span>1 <span class="sign">/</span> <span class="keyword">sqrt</span><span class="sign">(</span>1 <span class="sign">+</span> sigma2<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span> <span class="keyword">sqrt</span><span class="sign">(</span>log<span class="sign">(</span>1 <span class="sign">+</span> sigma2<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span> <span class="sign">)</span> 
<span class="line_number">541 </span>                Vi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">exp</span><span class="sign">(</span><span class="keyword">rnorm</span><span class="sign">(</span>1<span class="sign">,</span> log<span class="sign">(</span>1 <span class="sign">/</span> <span class="keyword">sqrt</span><span class="sign">(</span>1 <span class="sign">+</span> sigma2d<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span> <span class="keyword">sqrt</span><span class="sign">(</span>log<span class="sign">(</span>1 <span class="sign">+</span> sigma2d<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span> <span class="sign">)</span> 
<span class="line_number">542 </span>                Uijprop <span class="sign">&lt;</span><span class="sign">-</span> genlognormal<span class="sign">(</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> Ui<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> Ui<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> nu2<span class="sign">)</span>
<span class="line_number">543 </span>                Vijprop <span class="sign">&lt;</span><span class="sign">-</span> genlognormal<span class="sign">(</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> Vi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> Vi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> nu2d<span class="sign">)</span>
<span class="line_number">544 </span>                corrUV <span class="sign">&lt;</span><span class="sign">-</span> correlate<span class="sign">(</span>Uijprop<span class="sign">,</span> Vijprop<span class="sign">,</span> theta<span class="sign">)</span>
<span class="line_number">545 </span>                Uij<span class="sign">[</span>Jicum<span class="sign">[</span>i<span class="sign">]</span><span class="sign">:</span><span class="sign">(</span>Jicum<span class="sign">[</span>i <span class="sign">+</span> 1<span class="sign">]</span> <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> corrUV<span class="sign">$</span>x
<span class="line_number">546 </span>                Vij<span class="sign">[</span>Jicum<span class="sign">[</span>i<span class="sign">]</span><span class="sign">:</span><span class="sign">(</span>Jicum<span class="sign">[</span>i <span class="sign">+</span> 1<span class="sign">]</span> <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> corrUV<span class="sign">$</span>y            
<span class="line_number">547 </span>            <span class="sign">}</span>
<span class="line_number">548 </span>        <span class="sign">}</span>
<span class="line_number">549 </span>                   
<span class="line_number">550 </span>    <span class="sign">}</span>
<span class="line_number">551 </span>    <span class="keyword">return</span><span class="sign">(</span><span class="keyword">list</span><span class="sign">(</span>Ui <span class="sign">=</span> Ui<span class="sign">,</span> Vi <span class="sign">=</span> Vi<span class="sign">,</span> Uij <span class="sign">=</span> Uij<span class="sign">,</span> Vij <span class="sign">=</span> Vij<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">552 </span><span class="sign">}</span>
</pre>

<hr />
<a name="simulation2fgeneraterecurrent"></a>
<a name="robo64"></a><h2>simulation/generaterecurrent [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo5">simulation</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>generaterecurrent</strong>
</pre>
<p class="item_name">FUNCTION</p>
<p> Generates recurrent event times from a Weibull hazard with baseline lambda_0, shape gamma.
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">599 </span><strong>generaterecurrent</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>m<span class="sign">,</span> Ji<span class="sign">,</span> Zij<span class="sign">,</span> Uij<span class="sign">,</span> beta1<span class="sign">,</span> beta2<span class="sign">,</span> lambda0<span class="sign">,</span> gamweib<span class="sign">,</span> timedep<span class="sign">,</span> Cij<span class="sign">)</span>
<span class="line_number">600 </span><span class="sign">{</span>
</pre>
<p class="item_name">INPUTS</p>
<pre>    m      number of clusters
    Ji     cluster sizes
    Zij    covariates
    Uij    frailties
    beta1  coefficient for covariate 1
    beta2  coefficient for covariate 2 (if applicable)
    labmda0    weibull baseline
    gamweib    weibull shape
    timedep    boolean to indicate time-dependence
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">603 </span>    <span class="comment"># Convert the provided covariates into two matrices of time - dependent covariates</span>
<span class="line_number">604 </span>    <span class="keyword">if</span><span class="sign">(</span>timedep<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">605 </span>        Zij1 <span class="sign">&lt;</span><span class="sign">-</span> Zij<span class="sign">$</span>Zij1
<span class="line_number">606 </span>        Zij1times <span class="sign">&lt;</span><span class="sign">-</span> Zij<span class="sign">$</span>Zij1times
<span class="line_number">607 </span>        Zij2 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">dim</span><span class="sign">(</span>Zij1<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> 100<span class="sign">)</span>  
<span class="line_number">608 </span>        
<span class="line_number">609 </span>        Rij <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span> <span class="sign">*</span> 100<span class="sign">)</span><span class="sign">;</span> <span class="keyword">dim</span><span class="sign">(</span>Rij<span class="sign">)</span> <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">610 </span>        <span class="keyword">for</span><span class="sign">(</span>ind in 1<span class="sign">:</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">611 </span>        <span class="sign">{</span>
<span class="line_number">612 </span>            timescum <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">cumsum</span><span class="sign">(</span>Zij1times<span class="sign">[</span>ind<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">613 </span>            timescum<span class="sign">[</span>min<span class="sign">(</span><span class="keyword">which</span><span class="sign">(</span>timescum <span class="sign">&gt;</span> Cij<span class="sign">[</span>ind<span class="sign">]</span><span class="sign">)</span><span class="sign">)</span><span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> Inf
<span class="line_number">614 </span>            obstimes <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>timescum<span class="sign">[</span>timescum <span class="sign">&lt;</span> Cij<span class="sign">[</span>ind<span class="sign">]</span><span class="sign">]</span><span class="sign">,</span> Cij<span class="sign">[</span>ind<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">615 </span>            Rijcum <span class="sign">&lt;</span><span class="sign">-</span> 0<span class="sign">;</span>k <span class="sign">&lt;</span><span class="sign">-</span> 1
<span class="line_number">616 </span>            <span class="keyword">while</span><span class="sign">(</span>k <span class="sign">&lt;</span> 100<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">617 </span>                
<span class="line_number">618 </span>                hazards <span class="sign">&lt;</span><span class="sign">-</span> Uij<span class="sign">[</span>ind<span class="sign">]</span> <span class="sign">*</span> lambda0 <span class="sign">*</span> gamweib <span class="sign">*</span> <span class="sign">(</span>obstimes <span class="sign">-</span> Rijcum<span class="sign">)</span><span class="sign">^</span><span class="sign">(</span>gamweib <span class="sign">-</span> 1<span class="sign">)</span> <span class="sign">*</span>
<span class="line_number">619 </span>                    <span class="keyword">exp</span><span class="sign">(</span>beta1 <span class="sign">*</span> Zij1<span class="sign">[</span>ind<span class="sign">,</span> 1<span class="sign">:</span><span class="keyword">length</span><span class="sign">(</span>obstimes<span class="sign">)</span><span class="sign">]</span> <span class="sign">+</span> beta2 <span class="sign">*</span>
<span class="line_number">620 </span>                    Zij2<span class="sign">[</span>ind<span class="sign">,</span> 1<span class="sign">:</span><span class="keyword">length</span><span class="sign">(</span>obstimes<span class="sign">)</span><span class="sign">]</span><span class="sign">)</span>
<span class="line_number">621 </span>                maxhaz <span class="sign">&lt;</span><span class="sign">-</span> max<span class="sign">(</span>hazards<span class="sign">,</span> na<span class="sign">.</span>rm <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">622 </span>                accept <span class="sign">&lt;</span><span class="sign">-</span> FALSE
<span class="line_number">623 </span>                <span class="comment"># Generate by accept-reject</span>
<span class="line_number">624 </span>                n <span class="sign">&lt;</span><span class="sign">-</span> 0<span class="sign">;</span>Rijprop <span class="sign">&lt;</span><span class="sign">-</span> 0
<span class="line_number">625 </span>                <span class="keyword">while</span><span class="sign">(</span><span class="comment">!accept){</span>
<span class="line_number">626 </span>                    genunif <span class="sign">&lt;</span><span class="sign">-</span> runif<span class="sign">(</span>1<span class="sign">)</span>
<span class="line_number">627 </span>                    Rijprop <span class="sign">&lt;</span><span class="sign">-</span> Rijprop <span class="sign">-</span> 1 <span class="sign">/</span> maxhaz <span class="sign">*</span> log<span class="sign">(</span>genunif<span class="sign">)</span>
<span class="line_number">628 </span>                    thistime <span class="sign">&lt;</span><span class="sign">-</span> min<span class="sign">(</span><span class="keyword">which</span><span class="sign">(</span>timescum <span class="sign">&gt;</span> <span class="sign">(</span>Rijcum <span class="sign">+</span> Rijprop<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span>
<span class="line_number">629 </span>                    <span class="keyword">if</span><span class="sign">(</span>thistime <span class="sign">=</span><span class="sign">=</span> 101<span class="sign">)</span> thistime <span class="sign">&lt;</span><span class="sign">-</span> 100
<span class="line_number">630 </span>                    thishaz <span class="sign">&lt;</span><span class="sign">-</span> Uij<span class="sign">[</span>ind<span class="sign">]</span> <span class="sign">*</span> lambda0 <span class="sign">*</span> gamweib <span class="sign">*</span> <span class="sign">(</span>Rijprop<span class="sign">)</span><span class="sign">^</span><span class="sign">(</span>gamweib <span class="sign">-</span> 1<span class="sign">)</span> <span class="sign">*</span>
<span class="line_number">631 </span>                        <span class="keyword">exp</span><span class="sign">(</span>beta1 <span class="sign">*</span> Zij1<span class="sign">[</span>ind<span class="sign">,</span> thistime<span class="sign">]</span> <span class="sign">+</span> beta2 <span class="sign">*</span> Zij2<span class="sign">[</span>ind<span class="sign">,</span> thistime<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">632 </span>                    accunif <span class="sign">&lt;</span><span class="sign">-</span> runif<span class="sign">(</span>1<span class="sign">)</span>
<span class="line_number">633 </span>                    <span class="keyword">if</span><span class="sign">(</span>accunif <span class="sign">*</span> maxhaz <span class="sign">&lt;</span> thishaz<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">634 </span>                        Rij<span class="sign">[</span>ind<span class="sign">,</span> k<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> Rijprop
<span class="line_number">635 </span>                        Rijcum <span class="sign">&lt;</span><span class="sign">-</span> Rijcum <span class="sign">+</span> Rijprop
<span class="line_number">636 </span>                        <span class="keyword">if</span><span class="sign">(</span>Rijcum <span class="sign">&gt;</span> Cij<span class="sign">[</span>ind<span class="sign">]</span><span class="sign">)</span> k <span class="sign">&lt;</span><span class="sign">-</span> 100
<span class="line_number">637 </span>                        accept <span class="sign">&lt;</span><span class="sign">-</span> TRUE
<span class="line_number">638 </span>                    <span class="sign">}</span>
<span class="line_number">639 </span>                    n <span class="sign">&lt;</span><span class="sign">-</span> n <span class="sign">+</span> 1
<span class="line_number">640 </span>                <span class="sign">}</span>
<span class="line_number">641 </span>            k <span class="sign">&lt;</span><span class="sign">-</span> k <span class="sign">+</span> 1
<span class="line_number">642 </span>            <span class="sign">}</span>   
<span class="line_number">643 </span>        <span class="sign">}</span>
<span class="line_number">644 </span>        <span class="keyword">return</span><span class="sign">(</span>Rij<span class="sign">)</span>     
<span class="line_number">645 </span>    <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">646 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="comment">!is.matrix(Zij) &amp;&amp; !is.list(Zij)) {</span>
<span class="line_number">647 </span>            Zij1 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span><span class="keyword">rep</span><span class="sign">(</span>Zij<span class="sign">,</span> 100<span class="sign">)</span><span class="sign">,</span> <span class="keyword">length</span><span class="sign">(</span>Zij<span class="sign">)</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">648 </span>            Zij2 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">dim</span><span class="sign">(</span>Zij1<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">649 </span>        <span class="sign">}</span>
<span class="line_number">650 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span><span class="keyword">list</span><span class="sign">(</span>Zij<span class="sign">)</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">651 </span>            Zij1 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span><span class="keyword">rep</span><span class="sign">(</span>Zij<span class="sign">$</span>Zij1<span class="sign">,</span> 100<span class="sign">)</span><span class="sign">,</span> <span class="keyword">length</span><span class="sign">(</span>Zij<span class="sign">$</span>Zij1<span class="sign">)</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">652 </span>            Zij2 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span><span class="keyword">rep</span><span class="sign">(</span>Zij<span class="sign">$</span>Zij2<span class="sign">,</span> 100<span class="sign">)</span><span class="sign">,</span> <span class="keyword">length</span><span class="sign">(</span>Zij<span class="sign">$</span>Zij2<span class="sign">)</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">653 </span>        <span class="sign">}</span>    
<span class="line_number">654 </span>        <span class="comment"># Initialize output matrix</span>
<span class="line_number">655 </span>        Rij <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span> <span class="sign">*</span> 100<span class="sign">)</span>  <span class="comment"># Gap data for times between events</span>
<span class="line_number">656 </span>        <span class="keyword">dim</span><span class="sign">(</span>Rij<span class="sign">)</span> <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">,</span> 100<span class="sign">)</span>
<span class="line_number">657 </span>        <span class="comment"># Generate interevent gap times by inversion</span>
<span class="line_number">658 </span>        <span class="keyword">for</span><span class="sign">(</span>k in 1<span class="sign">:</span>100<span class="sign">)</span>  Rij<span class="sign">[</span><span class="sign">,</span> k<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">(</span><span class="sign">(</span><span class="sign">-</span><span class="keyword">exp</span><span class="sign">(</span><span class="sign">-</span>beta1 <span class="sign">*</span> Zij1<span class="sign">[</span><span class="sign">,</span> k<span class="sign">]</span> <span class="sign">-</span> beta2 <span class="sign">*</span> Zij2<span class="sign">[</span><span class="sign">,</span> k<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span>
<span class="line_number">659 </span>            log<span class="sign">(</span>1 <span class="sign">-</span> runif<span class="sign">(</span><span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span> <span class="sign">/</span> <span class="sign">(</span>lambda0 <span class="sign">*</span> Uij<span class="sign">)</span><span class="sign">)</span><span class="sign">^</span><span class="sign">(</span>1 <span class="sign">/</span> gamweib<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">660 </span>        Rij<span class="sign">[</span>Rij <span class="sign">=</span><span class="sign">=</span> 0<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 1
<span class="line_number">661 </span>        <span class="keyword">return</span><span class="sign">(</span>Rij<span class="sign">)</span>
<span class="line_number">662 </span>    <span class="sign">}</span>
<span class="line_number">663 </span><span class="sign">}</span>
</pre>

<hr />
<a name="simulation2finitsetup"></a>
<a name="robo65"></a><h2>simulation/initsetup [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo5">simulation</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>initsetup</strong>  --- intial setup for <a href="#robo5">simulation</a>
</pre>
<p class="item_name">FUNCTION</p>
<p>    Creates parameters for <a href="#robo5">simulation</a>
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">218 </span><strong>initsetup</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>timedep<span class="sign">,</span> m<span class="sign">,</span> Ji<span class="sign">,</span> K<span class="sign">,</span> Kd<span class="sign">,</span> fixzero<span class="sign">,</span> alternating <span class="sign">=</span> F<span class="sign">)</span>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">221 </span><span class="sign">{</span>
<span class="line_number">222 </span>    m <span class="sign">&lt;</span><span class="sign">-</span> m
<span class="line_number">223 </span>    Ji <span class="sign">&lt;</span><span class="sign">-</span> Ji
<span class="line_number">224 </span>    <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>fixzero<span class="sign">)</span><span class="sign">)</span> fixzero <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">""</span>
<span class="line_number">225 </span>    <span class="comment"># Variance of cluster frailty (rec)</span>
<span class="line_number">226 </span>    <span class="keyword">if</span><span class="sign">(</span>fixzero <span class="comment">!= "sigma2hat") sigma2 &lt;- .25  else sigma2 &lt;- 0 </span>
<span class="line_number">227 </span>    <span class="comment"># Variance of cluster frailty (death)</span>
<span class="line_number">228 </span>    <span class="keyword">if</span><span class="sign">(</span>fixzero <span class="comment">!= "sigma2dhat") sigma2d &lt;- .25 else sigma2d &lt;- 0 </span>
<span class="line_number">229 </span>    <span class="comment"># Additional variance for individual frailty (rec)</span>
<span class="line_number">230 </span>    <span class="keyword">if</span><span class="sign">(</span>fixzero <span class="comment">!= "nu2hat") nu2 &lt;- .25 else nu2 &lt;- 0 </span>
<span class="line_number">231 </span>    <span class="comment"># Additional variance for individual frailty (death)</span>
<span class="line_number">232 </span>    <span class="keyword">if</span><span class="sign">(</span>fixzero <span class="comment">!= "nu2dhat") nu2d &lt;- .25 else nu2d &lt;- 0 </span>
<span class="line_number">233 </span>    <span class="comment"># Covariance</span>
<span class="line_number">234 </span>    <span class="keyword">if</span><span class="sign">(</span>fixzero <span class="comment">!= "thetahat") theta &lt;- .125 else theta &lt;- 0 </span>
<span class="line_number">235 </span>    beta1d <span class="sign">&lt;</span><span class="sign">-</span> 1 <span class="comment"># Coefficient for the death process</span>
<span class="line_number">236 </span>    beta1 <span class="sign">&lt;</span><span class="sign">-</span> 1 <span class="comment"># Coefficient for the recurrent process</span>
<span class="line_number">237 </span>    beta2d <span class="sign">&lt;</span><span class="sign">-</span> 1 <span class="comment"># Coefficient for the death process</span>
<span class="line_number">238 </span>    beta2 <span class="sign">&lt;</span><span class="sign">-</span> 1 <span class="comment"># Coefficient for the recurrent process</span>
<span class="line_number">239 </span>    lambda0 <span class="sign">&lt;</span><span class="sign">-</span> 10 <span class="comment"># Baseline hazard for recurrent events</span>
<span class="line_number">240 </span>    lambda0d <span class="sign">&lt;</span><span class="sign">-</span> 10 <span class="comment"># Baseline hazard for death</span>
<span class="line_number">241 </span>    lambda0c <span class="sign">&lt;</span><span class="sign">-</span> 1 <span class="comment"># Baseline hazard for censoring</span>
<span class="line_number">242 </span>    <span class="keyword">if</span><span class="sign">(</span>alternating<span class="sign">)</span> lambda0c <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">.</span>25
<span class="line_number">243 </span>    gamweib <span class="sign">&lt;</span><span class="sign">-</span> 1<span class="sign">.</span>8 <span class="comment"># Shape parameter for Weibull distribution (rec)</span>
<span class="line_number">244 </span>    gamweibd <span class="sign">&lt;</span><span class="sign">-</span> 1<span class="sign">.</span>8 <span class="comment"># Shape parameter for Weibull distribution (death)</span>
<span class="line_number">245 </span>    gamweibc <span class="sign">&lt;</span><span class="sign">-</span> 1<span class="sign">.</span>8 <span class="comment"># Shape parameter for Weibull distribution (censoring)</span>
<span class="line_number">246 </span>    Z1mean <span class="sign">&lt;</span><span class="sign">-</span> 0 <span class="comment"># Mean of the Zij covariate (generation)</span>
<span class="line_number">247 </span>    Z1var <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">.</span>5 <span class="comment"># Variance of the Zij covariate (for generation)</span>
<span class="line_number">248 </span>    Z2mean <span class="sign">&lt;</span><span class="sign">-</span> 0 <span class="comment"># Mean of the Zij covariate (generation)</span>
<span class="line_number">249 </span>    Z2var <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">.</span>5 <span class="comment"># Variance of the Zij covariate (for generation)</span>
<span class="line_number">250 </span>    maxiter<span class="sign">.</span>outer <span class="sign">&lt;</span><span class="sign">-</span> 200
<span class="line_number">251 </span>    maxiter<span class="sign">.</span>inner <span class="sign">&lt;</span><span class="sign">-</span> 50
<span class="line_number">252 </span>    thresh<span class="sign">.</span>outer <span class="sign">&lt;</span><span class="sign">-</span> 1e<span class="sign">-</span>3
<span class="line_number">253 </span>    thresh<span class="sign">.</span>inner <span class="sign">&lt;</span><span class="sign">-</span> 1e<span class="sign">-</span>5
<span class="line_number">254 </span>    timedep <span class="sign">&lt;</span><span class="sign">-</span> timedep
<span class="line_number">255 </span>    K <span class="sign">&lt;</span><span class="sign">-</span> K <span class="comment"># Number of breaks in the baseline hazard</span>
<span class="line_number">256 </span>    Kd <span class="sign">&lt;</span><span class="sign">-</span> Kd <span class="comment"># Number of breaks in the baseline hazard for death</span>
<span class="line_number">257 </span>    params <span class="sign">=</span> <span class="keyword">list</span><span class="sign">(</span>m <span class="sign">=</span> m<span class="sign">,</span> Ji <span class="sign">=</span> Ji<span class="sign">,</span> sigma2 <span class="sign">=</span> sigma2<span class="sign">,</span> sigma2d <span class="sign">=</span> sigma2d<span class="sign">,</span> 
<span class="line_number">258 </span>            nu2 <span class="sign">=</span> nu2<span class="sign">,</span> nu2d <span class="sign">=</span> nu2d<span class="sign">,</span> theta <span class="sign">=</span> theta<span class="sign">,</span>
<span class="line_number">259 </span>            beta1d <span class="sign">=</span> beta1d<span class="sign">,</span> beta2d <span class="sign">=</span> beta2d<span class="sign">,</span> beta1 <span class="sign">=</span> beta1<span class="sign">,</span> beta2 <span class="sign">=</span> beta2<span class="sign">,</span>
<span class="line_number">260 </span>            lambda0 <span class="sign">=</span> lambda0<span class="sign">,</span> lambda0d <span class="sign">=</span> lambda0d<span class="sign">,</span> lambda0c <span class="sign">=</span> lambda0c<span class="sign">,</span>
<span class="line_number">261 </span>            gamweib <span class="sign">=</span> gamweib<span class="sign">,</span> gamweibd <span class="sign">=</span> gamweibd<span class="sign">,</span> gamweibc <span class="sign">=</span> gamweibc<span class="sign">,</span>
<span class="line_number">262 </span>            Z1mean <span class="sign">=</span> Z1mean<span class="sign">,</span> Z2mean <span class="sign">=</span> Z2mean<span class="sign">,</span> Z1var <span class="sign">=</span> Z1var<span class="sign">,</span> Z2var <span class="sign">=</span> Z2var<span class="sign">,</span>
<span class="line_number">263 </span>            maxiter<span class="sign">.</span>outer <span class="sign">=</span> maxiter<span class="sign">.</span>outer<span class="sign">,</span> maxiter<span class="sign">.</span>inner <span class="sign">=</span> maxiter<span class="sign">.</span>inner<span class="sign">,</span>
<span class="line_number">264 </span>            thresh<span class="sign">.</span>outer <span class="sign">=</span> thresh<span class="sign">.</span>outer<span class="sign">,</span> thresh<span class="sign">.</span>inner <span class="sign">=</span> thresh<span class="sign">.</span>inner<span class="sign">,</span>
<span class="line_number">265 </span>            timedep <span class="sign">=</span> timedep<span class="sign">,</span> K <span class="sign">=</span> K<span class="sign">,</span> Kd <span class="sign">=</span> Kd<span class="sign">)</span>
<span class="line_number">266 </span><span class="sign">}</span>
</pre>

<hr />
<a name="simulation2fL"></a>
<a name="robo66"></a><h2>simulation/L [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="#robo5">simulation</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>L</strong> --- stratification function
</pre>
<p class="item_name">FUNCTION</p>
<p>    Simulates strata
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">275 </span><strong>L</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>i<span class="sign">,</span> j<span class="sign">,</span> k<span class="sign">,</span> Z<span class="sign">)</span>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">278 </span><span class="sign">{</span>
<span class="line_number">279 </span>    <span class="comment"># Simple stratification: First event, stratum 1, events 2 - 3, stratum 2,</span>
<span class="line_number">280 </span>    <span class="comment"># after that, stratum 3</span>
<span class="line_number">281 </span>    <span class="keyword">if</span><span class="sign">(</span>k <span class="sign">=</span><span class="sign">=</span> 1<span class="sign">)</span><span class="sign">{</span>out <span class="sign">&lt;</span><span class="sign">-</span> 1<span class="sign">}</span>
<span class="line_number">282 </span>    <span class="keyword">if</span><span class="sign">(</span>k <span class="sign">&gt;</span> 1 <span class="sign">&amp;</span> k <span class="sign">&lt;</span> 4<span class="sign">)</span><span class="sign">{</span>out <span class="sign">&lt;</span><span class="sign">-</span> 2<span class="sign">}</span>
<span class="line_number">283 </span>    <span class="keyword">if</span><span class="sign">(</span>k <span class="sign">&gt;</span> 3<span class="sign">)</span><span class="sign">{</span>out <span class="sign">&lt;</span><span class="sign">-</span> 3<span class="sign">}</span>
<span class="line_number">284 </span>    out <span class="sign">&lt;</span><span class="sign">-</span> 1
<span class="line_number">285 </span>    <span class="keyword">return</span><span class="sign">(</span>out<span class="sign">)</span>
<span class="line_number">286 </span><span class="sign">}</span>
</pre>

</div> <!-- content -->
<div id="footer">
<p>Generated from ./blupsurv/R/bivrecsim.r with <a href="http://www.xs4all.nl/~rfsber/Robo/robodoc.html">ROBODoc</a> V4.99.36 on Thu Jun 19 2008 17:25:39
</p>
</div> <!-- footer -->
</body>
</html>
