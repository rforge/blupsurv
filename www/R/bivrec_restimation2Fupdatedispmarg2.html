<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" href="../robodoc.css" type="text/css" />
<title>./blupsurv/R/bivrec.r</title>
<!-- Source: ./blupsurv/R/bivrec.r -->
<!-- Generated with ROBODoc Version 4.99.36 (Jun 17 2008) -->
</head>
<body>
<div id="logo">

<a name="robo_top_of_doc" href="http://blupsurv.r-forge.r-project.org/">blupsurv</a>
</div> <!-- logo -->
<div id="navigation">
<a class="menuitem" href="./bivrec_rbivrecFit2Festimation.html#robo6">estimation</a><a class="menuitem" href="../robo_functions.html#robo_top_of_doc">Functions</a></div> <!-- navigation -->
<div id="content">
<h3>TABLE OF CONTENTS</h3>
<ul>
<li>1. <a href="#robo16">estimation/updatedispmarg2</a></li>
</ul>
<hr />
<a name="estimation2fupdatedispmarg2"></a>
<a name="robo16"></a><h2>estimation/updatedispmarg2 [ Functions ]</h2>

<p class="item_name">NAME</p>
<pre>    <strong>updatedispmarg2</strong> --- Marginal estimators for the dispersion parameters
</pre>
<p class="item_name">FUNCTION</p>
<p>    Compute dispersion parameter estimates using a marginal method, based on
    the moments of the event indicators delta under the auxiliary Poisson model.
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">1134 </span><strong>updatedispmarg2</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>m<span class="sign">,</span> Ji<span class="sign">,</span> datamat<span class="sign">,</span> datamatd<span class="sign">,</span> alphars<span class="sign">,</span> alpharsd<span class="sign">,</span> as<span class="sign">,</span> asd<span class="sign">,</span> 
<span class="line_number">1135 </span>                        betahat<span class="sign">,</span> betadhat<span class="sign">,</span> fixzero<span class="sign">,</span> univariate <span class="sign">=</span> FALSE<span class="sign">)</span>
</pre>
<p class="item_name">INPUTS</p>
<pre>    m          number of clusters
    Ji         cluster sizes
    datamat    data matrix generated by <a href="./bivrec_rinitialization2Fmakedatamat.html#robo37">makedatamat</a> for event 1
    datamatd   data matrix generated by <a href="./bivrec_rinitialization2Fmakedatamat.html#robo37">makedatamat</a> for event 2
    alphars    matrix of baseline hazard parameters for event 1
    alpharsd   matrix of baseline hazard parameters for event 2
    as         matrix of discretization breakpoints for event 1
    asd        matrix of discretization breakpoints for event 2
    betahat    regression coefficient estimates for event 1
    betadhat   regression coefficient estimates for event 2
    fixzero    list of estimators that should be fixed at zero (testing only)
    univariate boolean indicator whether a univariate model is being fit
</pre>
<p class="item_name">OUTPUTS</p>
<pre>    sigma2hat      cluster-level dispersion for process 1
    sigma2dhat     cluster-level dispersion for process 2
    nu2hat             subject-level dispersion for process 1
    nu2dhat            subject-level dispersion for process 2
    thetahat       subject-level covariance
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">1138 </span><span class="sign">{</span>
<span class="line_number">1139 </span>    <span class="comment"># The function <a href="./bivrec_restimation2Fgetdispmarg3.html#robo14">getdispmarg3</a> makes the FORTRAN calls that do most of the work</span>
<span class="line_number">1140 </span>    <span class="comment"># out1 contains only terms involving event 1</span>
<span class="line_number">1141 </span>    <span class="comment"># out2 only the event 2, and out3 contains the cross-terms</span>
<span class="line_number">1142 </span>    out1 <span class="sign">&lt;</span><span class="sign">-</span> <a href="./bivrec_restimation2Fgetdispmarg3.html#robo14">getdispmarg3</a><span class="sign">(</span>m<span class="sign">,</span> Ji<span class="sign">,</span> datamat<span class="sign">,</span> datamat<span class="sign">,</span> alphars<span class="sign">,</span> alphars<span class="sign">,</span> 
<span class="line_number">1143 </span>                    as<span class="sign">,</span> as<span class="sign">,</span> betahat<span class="sign">,</span> betahat<span class="sign">,</span> TRUE<span class="sign">)</span>
<span class="line_number">1144 </span>    out2 <span class="sign">&lt;</span><span class="sign">-</span> <a href="./bivrec_restimation2Fgetdispmarg3.html#robo14">getdispmarg3</a><span class="sign">(</span>m<span class="sign">,</span> Ji<span class="sign">,</span> datamatd<span class="sign">,</span> datamatd<span class="sign">,</span> alpharsd<span class="sign">,</span> alpharsd<span class="sign">,</span> 
<span class="line_number">1145 </span>                    asd<span class="sign">,</span> asd<span class="sign">,</span> betadhat<span class="sign">,</span> betadhat<span class="sign">,</span> TRUE<span class="sign">)</span>
<span class="line_number">1146 </span>    out3 <span class="sign">&lt;</span><span class="sign">-</span> <a href="./bivrec_restimation2Fgetdispmarg3.html#robo14">getdispmarg3</a><span class="sign">(</span>m<span class="sign">,</span> Ji<span class="sign">,</span> datamat<span class="sign">,</span> datamatd<span class="sign">,</span> alphars<span class="sign">,</span> alpharsd<span class="sign">,</span> 
<span class="line_number">1147 </span>                    as<span class="sign">,</span> asd<span class="sign">,</span> betahat<span class="sign">,</span> betadhat<span class="sign">,</span> FALSE<span class="sign">)</span>
<span class="line_number">1148 </span>
<span class="line_number">1149 </span>    <span class="comment"># Extract the estimated dispersion parameters, and truncate from below</span>
<span class="line_number">1150 </span>    sigma2hat <span class="sign">&lt;</span><span class="sign">-</span> max<span class="sign">(</span>out1<span class="sign">$</span>sig2<span class="sign">,</span> 1e<span class="sign">-</span>4<span class="sign">)</span>
<span class="line_number">1151 </span>    sigma2dhat <span class="sign">&lt;</span><span class="sign">-</span> max<span class="sign">(</span>out2<span class="sign">$</span>sig2<span class="sign">,</span> 1e<span class="sign">-</span>4<span class="sign">)</span>
<span class="line_number">1152 </span>    <span class="comment"># Fix parameters at 0 if desired</span>
<span class="line_number">1153 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="comment">!is.null(fixzero)){</span>
<span class="line_number">1154 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="quote">"sigma2hat"</span><span class="sign">%</span>in<span class="sign">%</span>fixzero<span class="sign">)</span> sigma2hat <span class="sign">&lt;</span><span class="sign">-</span> 0
<span class="line_number">1155 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="quote">"sigma2dhat"</span><span class="sign">%</span>in<span class="sign">%</span>fixzero<span class="sign">)</span> sigma2dhat <span class="sign">&lt;</span><span class="sign">-</span> 0
<span class="line_number">1156 </span>    <span class="sign">}</span>
<span class="line_number">1157 </span>    nu2hat <span class="sign">&lt;</span><span class="sign">-</span> max<span class="sign">(</span>out1<span class="sign">$</span>sig2nu2 <span class="sign">-</span> sigma2hat<span class="sign">,</span> 1e<span class="sign">-</span>4<span class="sign">)</span>
<span class="line_number">1158 </span>    nu2dhat <span class="sign">&lt;</span><span class="sign">-</span> max<span class="sign">(</span>out2<span class="sign">$</span>sig2nu2 <span class="sign">-</span> sigma2dhat<span class="sign">,</span> 1e<span class="sign">-</span>4<span class="sign">)</span>
<span class="line_number">1159 </span>    thetahat <span class="sign">&lt;</span><span class="sign">-</span> out3<span class="sign">$</span>sig2nu2
<span class="line_number">1160 </span>    <span class="comment"># Fix parameters at 0 if desired</span>
<span class="line_number">1161 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="comment">!is.null(fixzero)){</span>
<span class="line_number">1162 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="quote">"nu2hat"</span><span class="sign">%</span>in<span class="sign">%</span>fixzero<span class="sign">)</span> nu2hat <span class="sign">&lt;</span><span class="sign">-</span> 0
<span class="line_number">1163 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="quote">"nu2dhat"</span><span class="sign">%</span>in<span class="sign">%</span>fixzero<span class="sign">)</span> nu2dhat <span class="sign">&lt;</span><span class="sign">-</span> 0
<span class="line_number">1164 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="quote">"thetahat"</span><span class="sign">%</span>in<span class="sign">%</span>fixzero<span class="sign">)</span> thetahat <span class="sign">&lt;</span><span class="sign">-</span> 0
<span class="line_number">1165 </span>    <span class="sign">}</span>
<span class="line_number">1166 </span>    <span class="comment"># The marginal estimators do not guarantee that the esimated covariance matrix</span>
<span class="line_number">1167 </span>    <span class="comment"># is valid. This code truncates the estimate of thetahat if needed</span>
<span class="line_number">1168 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="comment">!univariate)</span>
<span class="line_number">1169 </span>        badtheta <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">try</span><span class="sign">(</span>thetahat <span class="sign">/</span> <span class="keyword">sqrt</span><span class="sign">(</span>nu2hat <span class="sign">*</span> nu2dhat<span class="sign">)</span> <span class="sign">&gt;</span> 1 <span class="sign">|</span> thetahat <span class="sign">/</span> 
<span class="line_number">1170 </span>            <span class="keyword">sqrt</span><span class="sign">(</span>nu2hat <span class="sign">*</span> nu2dhat<span class="sign">)</span><span class="sign">&lt;</span> <span class="sign">-</span>1<span class="sign">)</span>
<span class="line_number">1171 </span>    <span class="keyword">else</span> badtheta <span class="sign">&lt;</span><span class="sign">-</span> FALSE
<span class="line_number">1172 </span>    <span class="keyword">if</span><span class="sign">(</span>inherits<span class="sign">(</span>badtheta<span class="sign">,</span> <span class="quote">"try - error"</span><span class="sign">)</span> <span class="sign">|</span> is<span class="sign">.</span>na<span class="sign">(</span>badtheta<span class="sign">)</span><span class="sign">)</span> <span class="sign">{</span>browser<span class="sign">(</span><span class="sign">)</span><span class="sign">;</span> <span class="keyword">return</span><span class="sign">(</span>0<span class="sign">)</span><span class="sign">}</span>
<span class="line_number">1173 </span>    <span class="keyword">if</span><span class="sign">(</span>badtheta<span class="sign">)</span> thetahat <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">try</span><span class="sign">(</span>sign<span class="sign">(</span>thetahat<span class="sign">)</span> <span class="sign">*</span> <span class="keyword">sqrt</span><span class="sign">(</span>nu2hat <span class="sign">*</span> nu2dhat<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">1174 </span>    <span class="keyword">if</span><span class="sign">(</span>inherits<span class="sign">(</span>thetahat<span class="sign">,</span> <span class="quote">"try - error"</span><span class="sign">)</span><span class="sign">)</span> <span class="keyword">return</span><span class="sign">(</span>0<span class="sign">)</span>
<span class="line_number">1175 </span>    
<span class="line_number">1176 </span>    <span class="comment"># Prepare for output</span>
<span class="line_number">1177 </span>    <span class="keyword">return</span><span class="sign">(</span><span class="keyword">list</span><span class="sign">(</span>sigma2hat <span class="sign">=</span> sigma2hat<span class="sign">,</span>
<span class="line_number">1178 </span>                sigma2dhat <span class="sign">=</span> sigma2dhat<span class="sign">,</span>
<span class="line_number">1179 </span>                nu2hat <span class="sign">=</span> nu2hat<span class="sign">,</span>
<span class="line_number">1180 </span>                nu2dhat <span class="sign">=</span> nu2dhat<span class="sign">,</span>
<span class="line_number">1181 </span>                thetahat <span class="sign">=</span> thetahat<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">1182 </span><span class="sign">}</span>
</pre>

</div> <!-- content -->
<div id="footer">
<p>Generated from ./blupsurv/R/bivrec.r with <a href="http://www.xs4all.nl/~rfsber/Robo/robodoc.html">ROBODoc</a> V4.99.36 on Wed Jul 16 2008 11:47:16
</p>
</div> <!-- footer -->

<!-- Start of StatCounter Code -->
<script type="text/javascript">
var sc_project=3825293; 
var sc_invisible=1; 
var sc_partition=34; 
var sc_click_stat=1; 
var sc_security="2dd2334a"; 
</script>

<script type="text/javascript"
src="http://www.statcounter.com/counter/counter_xhtml.js"></script><noscript><div
class="statcounter"><a href="http://www.statcounter.com/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/3825293/0/2dd2334a/1/" alt="free html hit
counter" ></a></div></noscript>
<!-- End of StatCounter Code -->
</body>

</html>
