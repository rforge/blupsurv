<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" href="../robodoc.css" type="text/css" />
<title>./blupsurv/R/bivrec.r</title>
<!-- Source: ./blupsurv/R/bivrec.r -->
<!-- Generated with ROBODoc Version 4.99.36 (Jun 17 2008) -->
</head>
<body>
<div id="logo">

<a name="robo_top_of_doc" href="http://blupsurv.r-forge.r-project.org/">blupsurv</a>
</div> <!-- logo -->
<div id="navigation">
<a class="menuitem" href="./bivrec_rbivrecFit2FZZdebug.html#robo10">ZZdebug</a><a class="menuitem" href="../robo_functions.html#robo_top_of_doc">Functions</a></div> <!-- navigation -->
<div id="content">
<h3>TABLE OF CONTENTS</h3>
<ul>
<li>1. <a href="#robo77">ZZdebug/makeSens2</a></li>
</ul>
<hr />
<a name="ZZdebug2fmakeSens2"></a>
<a name="robo77"></a><h2>ZZdebug/makeSens2 [ Functions ]</h2>

<p class="item_name">NAME</p>
<pre>    <strong>makeSens2</strong> --- construct sensitivity matrix
</pre>
<p class="item_name">FUNCTION</p>
<p>    Construct the sensitivity matrix at the end of the procedure. This is an R
    implementation of the <a href="../src/bivrec_ffortran2Ffmksens2.html#robo25">fmksens2</a> FORTRAN routine used for debugging.
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">1976 </span><strong>makeSens2</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>m<span class="sign">,</span> Ji<span class="sign">,</span> datamat<span class="sign">,</span> datamatd<span class="sign">,</span> alphars<span class="sign">,</span> alpharsd<span class="sign">,</span> betahat<span class="sign">,</span> betadhat<span class="sign">,</span>
<span class="line_number">1977 </span>            as<span class="sign">,</span> asd<span class="sign">,</span> frailtyoutput<span class="sign">,</span> dispersionoutput<span class="sign">,</span> K<span class="sign">,</span> Kd<span class="sign">,</span> full <span class="sign">=</span> FALSE<span class="sign">)</span>
</pre>
<p class="item_name">INPUTS</p>
<pre>    m              number of clusters
    Ji             cluster sizes
    datamat        data matrix generated by <a href="./bivrec_rinitialization2Fmakedatamat.html#robo37">makedatamat</a> for event 1
    datamatd       data matrix generated by <a href="./bivrec_rinitialization2Fmakedatamat.html#robo37">makedatamat</a> for event 2
    alphars            matrix of baseline hazard parameters for event 1
    alpharsd           matrix of baseline hazard parameters for event 2
    betahat            regression coefficient estimates for event 
    betadhat           regression coefficient estimates for event 2
    as                 matrix of discretization breakpoints for event 1
    asd                matrix of discretization breakpoints for event 2
    frailtyoutput  output from <a href="./bivrec_restimation2Ffupdatefrailties4.html#robo13">fupdatefrailties4</a>
    dispersionoutput  output from one of the dispersion <a href="./bivrec_rbivrecFit2Festimation.html#robo6">estimation</a> routines
    K                  number of discretization intervals for event 1
    Kd                 number of discretization intervals for event 2
    full           boolean indicating whether full matrix should be computed.
                   If FALSE, only the sensitivity for betahat is returned. 
</pre>
<p class="item_name">OUTPUTS</p>
<pre>    S              Sensitivity matrix
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">1980 </span><span class="sign">{</span>
<span class="line_number">1981 </span>    <span class="comment"># Extract intermediate values from output</span>
<span class="line_number">1982 </span>    pi <span class="sign">&lt;</span><span class="sign">-</span> frailtyoutput<span class="sign">$</span>pqrs<span class="sign">$</span>pi<span class="sign">;</span> qi <span class="sign">&lt;</span><span class="sign">-</span> frailtyoutput<span class="sign">$</span>pqrs<span class="sign">$</span>qi<span class="sign">;</span>
<span class="line_number">1983 </span>    ri <span class="sign">&lt;</span><span class="sign">-</span> frailtyoutput<span class="sign">$</span>pqrs<span class="sign">$</span>ri<span class="sign">;</span> si <span class="sign">&lt;</span><span class="sign">-</span> frailtyoutput<span class="sign">$</span>pqrs<span class="sign">$</span>si<span class="sign">;</span>
<span class="line_number">1984 </span>    wij <span class="sign">&lt;</span><span class="sign">-</span> frailtyoutput<span class="sign">$</span>pqrs<span class="sign">$</span>wij<span class="sign">;</span>zij <span class="sign">&lt;</span><span class="sign">-</span> frailtyoutput<span class="sign">$</span>pqrs<span class="sign">$</span>zij<span class="sign">;</span>
<span class="line_number">1985 </span>    wi <span class="sign">&lt;</span><span class="sign">-</span> frailtyoutput<span class="sign">$</span>pqrs<span class="sign">$</span>wi
<span class="line_number">1986 </span>    sigma2hat <span class="sign">&lt;</span><span class="sign">-</span> dispersionoutput<span class="sign">$</span>sigma2hat<span class="sign">;</span>
<span class="line_number">1987 </span>    sigma2dhat <span class="sign">&lt;</span><span class="sign">-</span> dispersionoutput<span class="sign">$</span>sigma2dhat
<span class="line_number">1988 </span>    nu2hat <span class="sign">&lt;</span><span class="sign">-</span> dispersionoutput<span class="sign">$</span>nu2hat<span class="sign">;</span> nu2dhat <span class="sign">&lt;</span><span class="sign">-</span> dispersionoutput<span class="sign">$</span>nu2dhat
<span class="line_number">1989 </span>    thetahat <span class="sign">&lt;</span><span class="sign">-</span> dispersionoutput<span class="sign">$</span>thetahat
<span class="line_number">1990 </span>   
<span class="line_number">1991 </span>    ncovs <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">length</span><span class="sign">(</span>betahat<span class="sign">)</span>
<span class="line_number">1992 </span>
<span class="line_number">1993 </span>    Kcum <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">cumsum</span><span class="sign">(</span>c<span class="sign">(</span>1<span class="sign">,</span> K<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">1994 </span>    Kdcum <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">cumsum</span><span class="sign">(</span>c<span class="sign">(</span>1<span class="sign">,</span> Kd<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">1995 </span>    <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">1996 </span>        betaind <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>K<span class="sign">)</span> <span class="sign">+</span> 1<span class="sign">:</span>ncovs
<span class="line_number">1997 </span>        betadind <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>Kd<span class="sign">)</span> <span class="sign">+</span> 1<span class="sign">:</span>ncovs
<span class="line_number">1998 </span>    <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">1999 </span>        betaind <span class="sign">&lt;</span><span class="sign">-</span> 1<span class="sign">:</span>ncovs
<span class="line_number">2000 </span>        betadind <span class="sign">&lt;</span><span class="sign">-</span> 1<span class="sign">:</span>ncovs
<span class="line_number">2001 </span>    <span class="sign">}</span>
<span class="line_number">2002 </span>    
<span class="line_number">2003 </span>    <span class="comment"># Allocate storage</span>
<span class="line_number">2004 </span>    <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2005 </span>    S <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>K<span class="sign">)</span> <span class="sign">+</span> <span class="keyword">sum</span><span class="sign">(</span>Kd<span class="sign">)</span> <span class="sign">+</span> 2 <span class="sign">*</span> ncovs<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>K<span class="sign">)</span> <span class="sign">+</span> <span class="keyword">sum</span><span class="sign">(</span>Kd<span class="sign">)</span> <span class="sign">+</span> 2 <span class="sign">*</span> ncovs<span class="sign">)</span>
<span class="line_number">2006 </span>    <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">2007 </span>    S <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> 2 <span class="sign">*</span> ncovs<span class="sign">,</span> 2 <span class="sign">*</span> ncovs<span class="sign">)</span>
<span class="line_number">2008 </span>    <span class="sign">}</span>
<span class="line_number">2009 </span>    
<span class="line_number">2010 </span>    <span class="comment"># The sensitivity matrix is expressed as the sum of matrices corresponding</span>
<span class="line_number">2011 </span>    <span class="comment"># to each cluster</span>
<span class="line_number">2012 </span>    <span class="keyword">for</span><span class="sign">(</span>i in 1<span class="sign">:</span>m<span class="sign">)</span>
<span class="line_number">2013 </span>    <span class="sign">{</span>    
<span class="line_number">2014 </span>        <span class="comment"># Allocate storage for intermediate matrices</span>
<span class="line_number">2015 </span>        <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span><span class="sign">;</span> Setaij <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">2016 </span>        <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2017 </span>            Smuxij <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>K<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2018 </span>            Setaxijd <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Kd<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">)</span>
<span class="line_number">2019 </span>            S11 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>K<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>K<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2020 </span>            S12 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>K<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Kd<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2021 </span>            S13 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Kd<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Kd<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2022 </span>            S21 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>K<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">)</span><span class="sign">;</span> S22 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Kd<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2023 </span>            S31 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>K<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">)</span><span class="sign">;</span> S32 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Kd<span class="sign">)</span> <span class="sign">+</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2024 </span>        <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">2025 </span>            Smuxij <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2026 </span>            Setaxijd <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">,</span> ncovs<span class="sign">)</span>
<span class="line_number">2027 </span>            S11 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> ncovs<span class="sign">,</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2028 </span>            S12 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> ncovs<span class="sign">,</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2029 </span>            S13 <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> ncovs<span class="sign">,</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2030 </span>            S21 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> ncovs<span class="sign">)</span><span class="sign">;</span> S22 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2031 </span>            S31 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> ncovs<span class="sign">)</span><span class="sign">;</span> S32 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> ncovs<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">2032 </span>        <span class="sign">}</span>
<span class="line_number">2033 </span>                
<span class="line_number">2034 </span>        <span class="comment"># Find the index of the data matrices where cluster i begins</span>
<span class="line_number">2035 </span>        iind0 <span class="sign">&lt;</span><span class="sign">-</span> match<span class="sign">(</span>i<span class="sign">,</span> datamat<span class="sign">[</span><span class="sign">,</span> <span class="quote">"i"</span><span class="sign">]</span><span class="sign">)</span>
<span class="line_number">2036 </span>        <span class="keyword">if</span><span class="sign">(</span>i <span class="sign">&lt;</span> m<span class="sign">)</span> iind1 <span class="sign">&lt;</span><span class="sign">-</span> match<span class="sign">(</span>i <span class="sign">+</span> 1<span class="sign">,</span> datamat<span class="sign">[</span><span class="sign">,</span> <span class="quote">"i"</span><span class="sign">]</span><span class="sign">)</span> <span class="keyword">else</span> 
<span class="line_number">2037 </span>            iind1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">dim</span><span class="sign">(</span>datamat<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span> <span class="sign">+</span> 1
<span class="line_number">2038 </span>        iind0d <span class="sign">&lt;</span><span class="sign">-</span> match<span class="sign">(</span>i<span class="sign">,</span> datamatd<span class="sign">[</span><span class="sign">,</span> <span class="quote">"i"</span><span class="sign">]</span><span class="sign">)</span>
<span class="line_number">2039 </span>        <span class="keyword">if</span><span class="sign">(</span>i <span class="sign">&lt;</span> m<span class="sign">)</span> iind1d <span class="sign">&lt;</span><span class="sign">-</span> match<span class="sign">(</span>i <span class="sign">+</span> 1<span class="sign">,</span> datamatd<span class="sign">[</span><span class="sign">,</span> <span class="quote">"i"</span><span class="sign">]</span><span class="sign">)</span> <span class="keyword">else</span> 
<span class="line_number">2040 </span>            iind1d <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">dim</span><span class="sign">(</span>datamatd<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span> <span class="sign">+</span> 1
<span class="line_number">2041 </span>        
<span class="line_number">2042 </span>        <span class="comment"># Compute <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a>, Setaij, Smuxij, Setaxijd (first pass)</span>
<span class="line_number">2043 </span>        <span class="keyword">for</span><span class="sign">(</span>ind in iind0<span class="sign">:</span><span class="sign">(</span>iind1 <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">2044 </span>        <span class="sign">{</span>
<span class="line_number">2045 </span>            Z <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="sign">-</span><span class="sign">(</span>1<span class="sign">:</span>8<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span> ncovs<span class="sign">,</span> 1<span class="sign">)</span>
<span class="line_number">2046 </span>            bZ <span class="sign">&lt;</span><span class="sign">-</span> t<span class="sign">(</span>Z<span class="sign">)</span><span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>as<span class="sign">.</span>matrix<span class="sign">(</span>betahat<span class="sign">)</span>
<span class="line_number">2047 </span>            r <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"r"</span><span class="sign">]</span>
<span class="line_number">2048 </span>            smax <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"smax"</span><span class="sign">]</span>
<span class="line_number">2049 </span>            k <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"k"</span><span class="sign">]</span>
<span class="line_number">2050 </span>            j <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"j"</span><span class="sign">]</span>
<span class="line_number">2051 </span>            time <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"time"</span><span class="sign">]</span>
<span class="line_number">2052 </span>             <span class="keyword">if</span><span class="sign">(</span>smax <span class="sign">&gt;</span> 0<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2053 </span>                <span class="keyword">for</span><span class="sign">(</span>s in 1<span class="sign">:</span>smax<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2054 </span>                    mu <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">exp</span><span class="sign">(</span>bZ<span class="sign">)</span> <span class="sign">*</span> alphars<span class="sign">[</span>r<span class="sign">,</span> s<span class="sign">]</span> <span class="sign">*</span> <a href="../src/bivrec_ffortran2FA.html#robo20">A</a><span class="sign">(</span>time<span class="sign">,</span> as<span class="sign">,</span> r<span class="sign">,</span> s<span class="sign">)</span>
<span class="line_number">2055 </span>                    <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">[</span>j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">[</span>j<span class="sign">]</span> <span class="sign">+</span> mu
<span class="line_number">2056 </span>                    Smuxij<span class="sign">[</span>j<span class="sign">,</span> betaind<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> Smuxij<span class="sign">[</span>j<span class="sign">,</span> betaind<span class="sign">]</span> <span class="sign">+</span> mu <span class="sign">*</span> as<span class="sign">.</span>vector<span class="sign">(</span>Z<span class="sign">)</span>    
<span class="line_number">2057 </span>                    <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span> Smuxij<span class="sign">[</span>j<span class="sign">,</span> Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 
<span class="line_number">2058 </span>                        Smuxij<span class="sign">[</span>j<span class="sign">,</span> Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">+</span> mu        
<span class="line_number">2059 </span>                <span class="sign">}</span>
<span class="line_number">2060 </span>            <span class="sign">}</span>
<span class="line_number">2061 </span>        <span class="sign">}</span>
<span class="line_number">2062 </span>        <span class="keyword">for</span><span class="sign">(</span>ind in iind0d<span class="sign">:</span><span class="sign">(</span>iind1d <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">2063 </span>        <span class="sign">{</span>     
<span class="line_number">2064 </span>            Z <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="sign">-</span><span class="sign">(</span>1<span class="sign">:</span>8<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span> ncovs<span class="sign">,</span> 1<span class="sign">)</span>
<span class="line_number">2065 </span>            bdZ <span class="sign">&lt;</span><span class="sign">-</span> t<span class="sign">(</span>Z<span class="sign">)</span><span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>as<span class="sign">.</span>matrix<span class="sign">(</span>betadhat<span class="sign">)</span>
<span class="line_number">2066 </span>            r <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"r"</span><span class="sign">]</span>
<span class="line_number">2067 </span>            smaxd <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"smax"</span><span class="sign">]</span>
<span class="line_number">2068 </span>            k <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"k"</span><span class="sign">]</span>
<span class="line_number">2069 </span>            j <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"j"</span><span class="sign">]</span>
<span class="line_number">2070 </span>            time <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"time"</span><span class="sign">]</span>
<span class="line_number">2071 </span>             <span class="keyword">if</span><span class="sign">(</span>smaxd <span class="sign">&gt;</span> 0<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2072 </span>                <span class="keyword">for</span><span class="sign">(</span>s in 1<span class="sign">:</span>smaxd<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2073 </span>                    eta <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">exp</span><span class="sign">(</span>bdZ<span class="sign">)</span> <span class="sign">*</span> alpharsd<span class="sign">[</span>r<span class="sign">,</span> s<span class="sign">]</span> <span class="sign">*</span> <a href="../src/bivrec_ffortran2FA.html#robo20">A</a><span class="sign">(</span>time<span class="sign">,</span> asd<span class="sign">,</span> r<span class="sign">,</span> s<span class="sign">)</span>
<span class="line_number">2074 </span>                    Setaij<span class="sign">[</span>j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> Setaij<span class="sign">[</span>j<span class="sign">]</span> <span class="sign">+</span> eta
<span class="line_number">2075 </span>                    Setaxijd<span class="sign">[</span>j<span class="sign">,</span> betadind<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> Setaxijd<span class="sign">[</span>j<span class="sign">,</span> betadind<span class="sign">]</span> <span class="sign">+</span> eta <span class="sign">*</span> as<span class="sign">.</span>vector<span class="sign">(</span>Z<span class="sign">)</span>
<span class="line_number">2076 </span>                    <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span> Setaxijd<span class="sign">[</span>j<span class="sign">,</span> Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 
<span class="line_number">2077 </span>                        Setaxijd<span class="sign">[</span>j<span class="sign">,</span> Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">+</span> eta        
<span class="line_number">2078 </span>                <span class="sign">}</span>
<span class="line_number">2079 </span>            <span class="sign">}</span>
<span class="line_number">2080 </span>        <span class="sign">}</span>  
<span class="line_number">2081 </span>        
<span class="line_number">2082 </span>        phi <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">2083 </span>        <span class="keyword">for</span><span class="sign">(</span>j in 1<span class="sign">:</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2084 </span>            phi<span class="sign">[</span>j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">(</span>1 <span class="sign">+</span> nu2hat <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">[</span>j<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span> <span class="sign">(</span>1 <span class="sign">+</span> nu2dhat <span class="sign">*</span> Setaij<span class="sign">[</span>j<span class="sign">]</span><span class="sign">)</span> <span class="sign">-</span> 
<span class="line_number">2085 </span>                thetahat<span class="sign">^</span>2 <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">[</span>j<span class="sign">]</span> <span class="sign">*</span> Setaij<span class="sign">[</span>j<span class="sign">]</span>
<span class="line_number">2086 </span>        <span class="sign">}</span>         
<span class="line_number">2087 </span>        
<span class="line_number">2088 </span>        
<span class="line_number">2089 </span>        <span class="comment">## Compute the various components of the matrix (second pass) </span>
<span class="line_number">2090 </span>        <span class="keyword">for</span><span class="sign">(</span>ind in iind0<span class="sign">:</span><span class="sign">(</span>iind1 <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">2091 </span>        <span class="sign">{</span>
<span class="line_number">2092 </span>            Z <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="sign">-</span><span class="sign">(</span>1<span class="sign">:</span>8<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span> ncovs<span class="sign">,</span> 1<span class="sign">)</span>
<span class="line_number">2093 </span>            bZ <span class="sign">&lt;</span><span class="sign">-</span> t<span class="sign">(</span>Z<span class="sign">)</span><span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>as<span class="sign">.</span>matrix<span class="sign">(</span>betahat<span class="sign">)</span>
<span class="line_number">2094 </span>            Z2 <span class="sign">&lt;</span><span class="sign">-</span> Z<span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>t<span class="sign">(</span>Z<span class="sign">)</span>
<span class="line_number">2095 </span>            Z <span class="sign">&lt;</span><span class="sign">-</span> as<span class="sign">.</span>vector<span class="sign">(</span>Z<span class="sign">)</span>
<span class="line_number">2096 </span>            r <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"r"</span><span class="sign">]</span>
<span class="line_number">2097 </span>            smax <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"smax"</span><span class="sign">]</span>
<span class="line_number">2098 </span>            k <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"k"</span><span class="sign">]</span>     
<span class="line_number">2099 </span>            j <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"j"</span><span class="sign">]</span>
<span class="line_number">2100 </span>            time <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"time"</span><span class="sign">]</span>
<span class="line_number">2101 </span>            <span class="keyword">if</span><span class="sign">(</span>smax <span class="sign">&gt;</span> 0<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2102 </span>                <span class="keyword">for</span><span class="sign">(</span>s in 1<span class="sign">:</span>smax<span class="sign">)</span><span class="sign">{</span>   
<span class="line_number">2103 </span>                    mu <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">exp</span><span class="sign">(</span>bZ<span class="sign">)</span> <span class="sign">*</span> alphars<span class="sign">[</span>r<span class="sign">,</span> s<span class="sign">]</span> <span class="sign">*</span> <a href="../src/bivrec_ffortran2FA.html#robo20">A</a><span class="sign">(</span>time<span class="sign">,</span> as<span class="sign">,</span> r<span class="sign">,</span> s<span class="sign">)</span>
<span class="line_number">2104 </span>                    S11<span class="sign">[</span>betaind<span class="sign">,</span> betaind<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> S11<span class="sign">[</span>betaind<span class="sign">,</span> betaind<span class="sign">]</span> <span class="sign">+</span> 
<span class="line_number">2105 </span>                        as<span class="sign">.</span>vector<span class="sign">(</span>mu<span class="sign">)</span> <span class="sign">*</span> Z2
<span class="line_number">2106 </span>                    <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2107 </span>                        S11<span class="sign">[</span>Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">,</span> Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 
<span class="line_number">2108 </span>                            S11<span class="sign">[</span>Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">,</span> Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">+</span> mu
<span class="line_number">2109 </span>                        S11<span class="sign">[</span>Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">,</span> betaind<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 
<span class="line_number">2110 </span>                            S11<span class="sign">[</span>Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">,</span> betaind<span class="sign">]</span> <span class="sign">+</span> mu <span class="sign">*</span> Z
<span class="line_number">2111 </span>                        S11<span class="sign">[</span>betaind<span class="sign">,</span> Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 
<span class="line_number">2112 </span>                            S11<span class="sign">[</span>betaind<span class="sign">,</span> Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">+</span> mu <span class="sign">*</span> Z
<span class="line_number">2113 </span>                    <span class="sign">}</span>
<span class="line_number">2114 </span>                    w <span class="sign">&lt;</span><span class="sign">-</span> 1 <span class="sign">/</span> <span class="sign">(</span>1 <span class="sign">+</span> wij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">[</span>j<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">2115 </span>                    S21<span class="sign">[</span>betaind<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> S21<span class="sign">[</span>betaind<span class="sign">]</span> <span class="sign">+</span> w <span class="sign">*</span> mu <span class="sign">*</span> Z
<span class="line_number">2116 </span>                    <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span> S21<span class="sign">[</span>Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> S21<span class="sign">[</span>Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">+</span> w <span class="sign">*</span> mu
<span class="line_number">2117 </span>                    
<span class="line_number">2118 </span>                    w<span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>thetahat <span class="sign">*</span> Setaij<span class="sign">[</span>j<span class="sign">]</span> <span class="sign">/</span> phi<span class="sign">[</span>j<span class="sign">]</span>
<span class="line_number">2119 </span>                    S31<span class="sign">[</span>betaind<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> S31<span class="sign">[</span>betaind<span class="sign">]</span> <span class="sign">+</span> w <span class="sign">*</span> mu <span class="sign">*</span> Z 
<span class="line_number">2120 </span>                    <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span> S31<span class="sign">[</span>Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> S31<span class="sign">[</span>Kcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">+</span> w <span class="sign">*</span> mu
<span class="line_number">2121 </span>                <span class="sign">}</span>
<span class="line_number">2122 </span>            <span class="sign">}</span>
<span class="line_number">2123 </span>        <span class="sign">}</span>
<span class="line_number">2124 </span>        <span class="keyword">for</span><span class="sign">(</span>ind in iind0d<span class="sign">:</span><span class="sign">(</span>iind1d <span class="sign">-</span> 1<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">2125 </span>        <span class="sign">{</span>
<span class="line_number">2126 </span>           Z <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="sign">-</span><span class="sign">(</span>1<span class="sign">:</span>8<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span> ncovs<span class="sign">,</span> 1<span class="sign">)</span>
<span class="line_number">2127 </span>           bdZ <span class="sign">&lt;</span><span class="sign">-</span> t<span class="sign">(</span>Z<span class="sign">)</span><span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>as<span class="sign">.</span>matrix<span class="sign">(</span>betadhat<span class="sign">)</span>
<span class="line_number">2128 </span>           Z2 <span class="sign">&lt;</span><span class="sign">-</span> Z<span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>t<span class="sign">(</span>Z<span class="sign">)</span>
<span class="line_number">2129 </span>           Z <span class="sign">&lt;</span><span class="sign">-</span> as<span class="sign">.</span>vector<span class="sign">(</span>Z<span class="sign">)</span>
<span class="line_number">2130 </span>           r <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"r"</span><span class="sign">]</span>
<span class="line_number">2131 </span>           smaxd <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"smax"</span><span class="sign">]</span>
<span class="line_number">2132 </span>           k <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"k"</span><span class="sign">]</span>     
<span class="line_number">2133 </span>           j <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"j"</span><span class="sign">]</span>
<span class="line_number">2134 </span>           time <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span>ind<span class="sign">,</span> <span class="quote">"time"</span><span class="sign">]</span>
<span class="line_number">2135 </span>           <span class="keyword">if</span><span class="sign">(</span>smaxd <span class="sign">&gt;</span> 0<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2136 </span>                <span class="keyword">for</span><span class="sign">(</span>s in 1<span class="sign">:</span>smaxd<span class="sign">)</span><span class="sign">{</span>   
<span class="line_number">2137 </span>                    eta <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">exp</span><span class="sign">(</span>bdZ<span class="sign">)</span> <span class="sign">*</span> alpharsd<span class="sign">[</span>r<span class="sign">,</span> s<span class="sign">]</span> <span class="sign">*</span> <a href="../src/bivrec_ffortran2FA.html#robo20">A</a><span class="sign">(</span>time<span class="sign">,</span> asd<span class="sign">,</span> r<span class="sign">,</span> s<span class="sign">)</span>
<span class="line_number">2138 </span>                    S13<span class="sign">[</span>betadind<span class="sign">,</span> betadind<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> S13<span class="sign">[</span>betadind<span class="sign">,</span> betadind<span class="sign">]</span> <span class="sign">+</span>
<span class="line_number">2139 </span>                        as<span class="sign">.</span>vector<span class="sign">(</span>eta<span class="sign">)</span> <span class="sign">*</span> Z2
<span class="line_number">2140 </span>                    <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2141 </span>                        S13<span class="sign">[</span>Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">,</span> Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 
<span class="line_number">2142 </span>                            S13<span class="sign">[</span>Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">,</span> Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">+</span> eta
<span class="line_number">2143 </span>                        S13<span class="sign">[</span>Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">,</span> betadind<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span>
<span class="line_number">2144 </span>                            S13<span class="sign">[</span>Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">,</span> betadind<span class="sign">]</span> <span class="sign">+</span> eta <span class="sign">*</span> Z
<span class="line_number">2145 </span>                        S13<span class="sign">[</span>betadind<span class="sign">,</span> Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span>
<span class="line_number">2146 </span>                            S13<span class="sign">[</span>betadind<span class="sign">,</span> Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">+</span> eta <span class="sign">*</span> Z
<span class="line_number">2147 </span>                    <span class="sign">}</span>
<span class="line_number">2148 </span>                    w<span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>thetahat <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">[</span>j<span class="sign">]</span> <span class="sign">/</span> phi<span class="sign">[</span>j<span class="sign">]</span>
<span class="line_number">2149 </span>                    S22<span class="sign">[</span>betadind<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> S22<span class="sign">[</span>betadind<span class="sign">]</span> <span class="sign">+</span> w <span class="sign">*</span> eta <span class="sign">*</span> Z
<span class="line_number">2150 </span>                    <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span> S22<span class="sign">[</span>Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> S22<span class="sign">[</span>Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">+</span> w <span class="sign">*</span> eta
<span class="line_number">2151 </span>                    
<span class="line_number">2152 </span>                    w <span class="sign">&lt;</span><span class="sign">-</span> 1 <span class="sign">/</span> <span class="sign">(</span>1 <span class="sign">+</span> zij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">*</span> Setaij<span class="sign">[</span>j<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">2153 </span>                    S32<span class="sign">[</span>betadind<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> S32<span class="sign">[</span>betadind<span class="sign">]</span> <span class="sign">+</span> w <span class="sign">*</span> eta <span class="sign">*</span> Z
<span class="line_number">2154 </span>                    <span class="keyword">if</span><span class="sign">(</span>full<span class="sign">)</span> S32<span class="sign">[</span>Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> S32<span class="sign">[</span>Kdcum<span class="sign">[</span>r<span class="sign">]</span> <span class="sign">+</span> s <span class="sign">-</span> 1<span class="sign">]</span> <span class="sign">+</span> w <span class="sign">*</span> eta
<span class="line_number">2155 </span>                <span class="sign">}</span>
<span class="line_number">2156 </span>            <span class="sign">}</span>
<span class="line_number">2157 </span>        <span class="sign">}</span>
<span class="line_number">2158 </span>        
<span class="line_number">2159 </span>        <span class="keyword">for</span><span class="sign">(</span>j in 1<span class="sign">:</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">2160 </span>            S11 <span class="sign">&lt;</span><span class="sign">-</span> S11 <span class="sign">-</span> wij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">/</span> <span class="sign">(</span>1 <span class="sign">+</span> wij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">[</span>j<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span> 
<span class="line_number">2161 </span>                Smuxij<span class="sign">[</span>j<span class="sign">,</span> <span class="sign">]</span><span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>t<span class="sign">(</span>Smuxij<span class="sign">[</span>j<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">2162 </span>            S12 <span class="sign">&lt;</span><span class="sign">-</span> S12 <span class="sign">-</span> thetahat <span class="sign">/</span> phi<span class="sign">[</span>j<span class="sign">]</span> <span class="sign">*</span> Smuxij<span class="sign">[</span>j<span class="sign">,</span> <span class="sign">]</span><span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>t<span class="sign">(</span>Setaxijd<span class="sign">[</span>j<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">2163 </span>            S13 <span class="sign">&lt;</span><span class="sign">-</span> S13 <span class="sign">-</span> zij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">/</span> <span class="sign">(</span>1 <span class="sign">+</span> zij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">*</span> Setaij<span class="sign">[</span>j<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span> 
<span class="line_number">2164 </span>                Setaxijd<span class="sign">[</span>j<span class="sign">,</span> <span class="sign">]</span><span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>t<span class="sign">(</span>Setaxijd<span class="sign">[</span>j<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">2165 </span>        <span class="sign">}</span>
<span class="line_number">2166 </span>        
<span class="line_number">2167 </span>        S2 <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>S21<span class="sign">,</span> S22<span class="sign">)</span>
<span class="line_number">2168 </span>        S3 <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>S31<span class="sign">,</span> S32<span class="sign">)</span>
<span class="line_number">2169 </span>                
<span class="line_number">2170 </span>        S <span class="sign">&lt;</span><span class="sign">-</span> S <span class="sign">-</span> <span class="keyword">rbind</span><span class="sign">(</span><span class="keyword">cbind</span><span class="sign">(</span>S11<span class="sign">,</span> S12<span class="sign">)</span><span class="sign">,</span> <span class="keyword">cbind</span><span class="sign">(</span>t<span class="sign">(</span>S12<span class="sign">)</span><span class="sign">,</span> S13<span class="sign">)</span><span class="sign">)</span> <span class="sign">+</span>
<span class="line_number">2171 </span>            wi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> <span class="sign">(</span>sigma2hat <span class="sign">*</span> <span class="sign">(</span>1 <span class="sign">+</span> sigma2dhat <span class="sign">*</span> si<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span> S2<span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>t<span class="sign">(</span>S2<span class="sign">)</span> <span class="sign">-</span>
<span class="line_number">2172 </span>            sigma2hat <span class="sign">*</span> sigma2dhat <span class="sign">*</span> qi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> <span class="sign">(</span>S3<span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>t<span class="sign">(</span>S2<span class="sign">)</span> <span class="sign">+</span> S2<span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>t<span class="sign">(</span>S3<span class="sign">)</span><span class="sign">)</span> <span class="sign">+</span> 
<span class="line_number">2173 </span>            sigma2dhat <span class="sign">*</span> <span class="sign">(</span>1 <span class="sign">+</span> sigma2hat <span class="sign">*</span> pi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span> S3<span class="sign">%</span><span class="sign">*</span><span class="sign">%</span>t<span class="sign">(</span>S3<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">2174 </span>    <span class="sign">}</span>
<span class="line_number">2175 </span>    <span class="keyword">return</span><span class="sign">(</span>S<span class="sign">)</span>
<span class="line_number">2176 </span><span class="sign">}</span>
</pre>

</div> <!-- content -->
<div id="footer">
<p>Generated from ./blupsurv/R/bivrec.r with <a href="http://www.xs4all.nl/~rfsber/Robo/robodoc.html">ROBODoc</a> V4.99.36 on Wed Jul 16 2008 11:47:16
</p>
</div> <!-- footer -->

<!-- Start of StatCounter Code -->
<script type="text/javascript">
var sc_project=3825293; 
var sc_invisible=1; 
var sc_partition=34; 
var sc_click_stat=1; 
var sc_security="2dd2334a"; 
</script>

<script type="text/javascript"
src="http://www.statcounter.com/counter/counter_xhtml.js"></script><noscript><div
class="statcounter"><a href="http://www.statcounter.com/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/3825293/0/2dd2334a/1/" alt="free html hit
counter" ></a></div></noscript>
<!-- End of StatCounter Code -->
</body>

</html>
