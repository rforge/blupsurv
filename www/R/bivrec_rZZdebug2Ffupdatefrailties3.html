<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" href="../robodoc.css" type="text/css" />
<title>./blupsurv/R/bivrec.r</title>
<!-- Source: ./blupsurv/R/bivrec.r -->
<!-- Generated with ROBODoc Version 4.99.36 (Jun 17 2008) -->
</head>
<body>
<div id="logo">

<a name="robo_top_of_doc" href="http://blupsurv.r-forge.r-project.org/">blupsurv</a>
</div> <!-- logo -->
<div id="navigation">
<a class="menuitem" href="./bivrec_rbivrecFit2FZZdebug.html#robo10">ZZdebug</a><a class="menuitem" href="../robo_functions.html#robo_top_of_doc">Functions</a></div> <!-- navigation -->
<div id="content">
<h3>TABLE OF CONTENTS</h3>
<ul>
<li>1. <a href="#robo74">ZZdebug/fupdatefrailties3</a></li>
</ul>
<hr />
<a name="ZZdebug2ffupdatefrailties3"></a>
<a name="robo74"></a><h2>ZZdebug/fupdatefrailties3 [ Functions ]</h2>

<p class="item_name">NAME</p>
<pre>    <strong>fupdatefrailties3</strong> --- update frailty estimates
</pre>
<p class="item_name">FUNCTION</p>
<p>    Drop-in replacement for <a href="./bivrec_restimation2Ffupdatefrailties4.html#robo13">fupdatefrailties4</a>, which updates the frailties
    using only Fortran calls to low-level functionality like <a href="../src/bivrec_ffortran2Ffsmuij.html#robo31">fsmuij</a>. See
    <a href="./bivrec_restimation2Ffupdatefrailties4.html#robo13">fupdatefrailties4</a> for details.
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">480 </span><strong>fupdatefrailties3</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>m<span class="sign">,</span> Ji<span class="sign">,</span> datamat<span class="sign">,</span> datamatd<span class="sign">,</span> alphars<span class="sign">,</span> alpharsd<span class="sign">,</span> as<span class="sign">,</span> asd<span class="sign">,</span> betahat<span class="sign">,</span> betadhat<span class="sign">,</span> dispparams<span class="sign">)</span>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">483 </span><span class="sign">{</span>
<span class="line_number">484 </span>  <span class="comment">#  cat("\tUpdating frailty estimates\n")</span>
<span class="line_number">485 </span>        
<span class="line_number">486 </span>    <span class="comment">## Extract dispersion parameter estimates</span>
<span class="line_number">487 </span>    sigma2hat <span class="sign">&lt;</span><span class="sign">-</span> dispparams<span class="sign">$</span>sigma2hat
<span class="line_number">488 </span>    sigma2dhat <span class="sign">&lt;</span><span class="sign">-</span> dispparams<span class="sign">$</span>sigma2dhat
<span class="line_number">489 </span>    nu2hat <span class="sign">&lt;</span><span class="sign">-</span> dispparams<span class="sign">$</span>nu2hat
<span class="line_number">490 </span>    nu2dhat <span class="sign">&lt;</span><span class="sign">-</span> dispparams<span class="sign">$</span>nu2dhat
<span class="line_number">491 </span>    thetahat <span class="sign">&lt;</span><span class="sign">-</span> dispparams<span class="sign">$</span>thetahat
<span class="line_number">492 </span>    
<span class="line_number">493 </span>    <span class="comment">## Initialize frailty vectors</span>
<span class="line_number">494 </span>    Uihat <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span><span class="sign">;</span>Vihat <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">495 </span>    Uijhat <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>Vijhat <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">sum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">496 </span>
<span class="line_number">497 </span>   <span class="comment">## Initialize matrices for storage of pi, qi, pij, qij, etc.</span>
<span class="line_number">498 </span>    jimax <span class="sign">&lt;</span><span class="sign">-</span> max<span class="sign">(</span>Ji<span class="sign">)</span>
<span class="line_number">499 </span>    pi <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span><span class="sign">;</span>qi <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span><span class="sign">;</span>ri <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span><span class="sign">;</span>si <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span>
<span class="line_number">500 </span>    piprime <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span><span class="sign">;</span>qiprime <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">501 </span>    riprime <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span><span class="sign">;</span>siprime <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">502 </span>    wi <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rep</span><span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">)</span>
<span class="line_number">503 </span>    pij <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>pijprime <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">504 </span>    qij <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>qijprime <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">505 </span>    rij <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>rijprime <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">506 </span>    sij <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>sijprime <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">507 </span>    wij <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>zij <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">508 </span>
<span class="line_number">509 </span>    Smu <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>Sdelta <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">510 </span>    Seta <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>SDelta <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>0<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">511 </span>  
<span class="line_number">512 </span>    covs <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>datamat<span class="sign">[</span><span class="sign">,</span> <span class="sign">-</span><span class="sign">(</span>1<span class="sign">:</span>8<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span> <span class="keyword">dim</span><span class="sign">(</span>datamat<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> <span class="keyword">dim</span><span class="sign">(</span>datamat<span class="sign">)</span><span class="sign">[</span>2<span class="sign">]</span> <span class="sign">-</span> 8<span class="sign">)</span>
<span class="line_number">513 </span>    ncovs <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">dim</span><span class="sign">(</span>covs<span class="sign">)</span><span class="sign">[</span>2<span class="sign">]</span>
<span class="line_number">514 </span>    d <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">dim</span><span class="sign">(</span>covs<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span>
<span class="line_number">515 </span>    index <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span><span class="sign">,</span> c<span class="sign">(</span><span class="quote">"i"</span><span class="sign">,</span> <span class="quote">"j"</span><span class="sign">,</span> <span class="quote">"k"</span><span class="sign">,</span> <span class="quote">"r"</span><span class="sign">,</span> <span class="quote">"smin"</span><span class="sign">,</span> <span class="quote">"smax"</span><span class="sign">)</span><span class="sign">]</span>
<span class="line_number">516 </span>    delta <span class="sign">&lt;</span><span class="sign">-</span> datamat<span class="sign">[</span><span class="sign">,</span> <span class="quote">"delta"</span><span class="sign">]</span>
<span class="line_number">517 </span>    
<span class="line_number">518 </span>    Sm <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">try</span><span class="sign">(</span><span class="sign">.</span>Fortran<span class="sign">(</span><span class="quote">"<a href="../src/bivrec_ffortran2Ffsmuij.html#robo31">fsmuij</a>"</span><span class="sign">,</span> 
<span class="line_number">519 </span>        betahat <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>betahat<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">520 </span>        index <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span>index<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">521 </span>        delta <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>delta<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">522 </span>        Z <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>covs<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">523 </span>        alphars <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>alphars<span class="sign">)</span><span class="sign">,</span> 
<span class="line_number">524 </span>        as <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>as<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">525 </span>        d <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span>d<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">526 </span>        ncovs <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span>ncovs<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">527 </span>        nr <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span><span class="keyword">dim</span><span class="sign">(</span>alphars<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">528 </span>        ns <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span><span class="keyword">dim</span><span class="sign">(</span>alphars<span class="sign">)</span><span class="sign">[</span>2<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">529 </span>        m <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span>m<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">530 </span>        maxj <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span>max<span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">531 </span>        Smu <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>Smu<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">532 </span>        Sdelta <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>Sdelta<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span>
<span class="line_number">533 </span>    Smu <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>Sm<span class="sign">$</span>Smu<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span>
<span class="line_number">534 </span>    Sdelta <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>Sm<span class="sign">$</span>Sdelta<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span>
<span class="line_number">535 </span>    
<span class="line_number">536 </span>    covs <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>datamatd<span class="sign">[</span><span class="sign">,</span> <span class="sign">-</span><span class="sign">(</span>1<span class="sign">:</span>8<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span> <span class="keyword">dim</span><span class="sign">(</span>datamatd<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> <span class="keyword">dim</span><span class="sign">(</span>datamatd<span class="sign">)</span><span class="sign">[</span>2<span class="sign">]</span> <span class="sign">-</span> 8<span class="sign">)</span>
<span class="line_number">537 </span>    ncovs <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">dim</span><span class="sign">(</span>covs<span class="sign">)</span><span class="sign">[</span>2<span class="sign">]</span>
<span class="line_number">538 </span>    d <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">dim</span><span class="sign">(</span>covs<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span>
<span class="line_number">539 </span>    index <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span><span class="sign">,</span> c<span class="sign">(</span><span class="quote">"i"</span><span class="sign">,</span> <span class="quote">"j"</span><span class="sign">,</span> <span class="quote">"k"</span><span class="sign">,</span> <span class="quote">"r"</span><span class="sign">,</span> <span class="quote">"smin"</span><span class="sign">,</span> <span class="quote">"smax"</span><span class="sign">)</span><span class="sign">]</span>
<span class="line_number">540 </span>    Delta <span class="sign">&lt;</span><span class="sign">-</span> datamatd<span class="sign">[</span><span class="sign">,</span> <span class="quote">"delta"</span><span class="sign">]</span>
<span class="line_number">541 </span>    
<span class="line_number">542 </span>    Se <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">try</span><span class="sign">(</span><span class="sign">.</span>Fortran<span class="sign">(</span><span class="quote">"<a href="../src/bivrec_ffortran2Ffsmuij.html#robo31">fsmuij</a>"</span><span class="sign">,</span>
<span class="line_number">543 </span>         betahat <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>betadhat<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">544 </span>         index <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span>index<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">545 </span>         delta <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>Delta<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">546 </span>         Z <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>covs<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">547 </span>         alphars <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>alpharsd<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">548 </span>         as <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>asd<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">549 </span>         d <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span>d<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">550 </span>         ncovs <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span>ncovs<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">551 </span>         nr <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span><span class="keyword">dim</span><span class="sign">(</span>alpharsd<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">552 </span>         ns <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span><span class="keyword">dim</span><span class="sign">(</span>alpharsd<span class="sign">)</span><span class="sign">[</span>2<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">553 </span>         m <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span>m<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">554 </span>         maxj <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">integer</span><span class="sign">(</span>max<span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">555 </span>         Smu <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>Seta<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">556 </span>         Sdelta <span class="sign">=</span> as<span class="sign">.</span><span class="keyword">double</span><span class="sign">(</span>SDelta<span class="sign">)</span><span class="sign">)</span><span class="sign">)</span>
<span class="line_number">557 </span>    Seta <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>Se<span class="sign">$</span>Smu<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span>
<span class="line_number">558 </span>    SDelta <span class="sign">&lt;</span><span class="sign">-</span> matrix<span class="sign">(</span>Se<span class="sign">$</span>Sdelta<span class="sign">,</span> m<span class="sign">,</span> jimax<span class="sign">)</span>
<span class="line_number">559 </span>
<span class="line_number">560 </span>    
<span class="line_number">561 </span>    <span class="keyword">for</span><span class="sign">(</span>i in 1<span class="sign">:</span>m<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">562 </span>        <span class="keyword">for</span><span class="sign">(</span>j in 1<span class="sign">:</span>Ji<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">563 </span>            <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a> <span class="sign">&lt;</span><span class="sign">-</span> Smu<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span>
<span class="line_number">564 </span>            Setaij <span class="sign">&lt;</span><span class="sign">-</span> Seta<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span>
<span class="line_number">565 </span>            Sdeltaij <span class="sign">&lt;</span><span class="sign">-</span> Sdelta<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span>
<span class="line_number">566 </span>            SDeltaij <span class="sign">&lt;</span><span class="sign">-</span> SDelta<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span>
<span class="line_number">567 </span>            
<span class="line_number">568 </span>            wij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> nu2hat <span class="sign">-</span> thetahat<span class="sign">^</span>2 <span class="sign">*</span> Setaij <span class="sign">/</span> <span class="sign">(</span>1 <span class="sign">+</span> nu2dhat <span class="sign">*</span> Setaij<span class="sign">)</span>
<span class="line_number">569 </span>            zij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> nu2dhat <span class="sign">-</span> thetahat<span class="sign">^</span>2 <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a> <span class="sign">/</span> <span class="sign">(</span>1 <span class="sign">+</span> nu2hat <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">)</span>
<span class="line_number">570 </span>            pij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a> <span class="sign">/</span> <span class="sign">(</span>1 <span class="sign">+</span> wij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">)</span>
<span class="line_number">571 </span>            qij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>thetahat <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a> <span class="sign">*</span> Setaij <span class="sign">/</span> <span class="sign">(</span><span class="sign">(</span>1 <span class="sign">+</span> nu2hat <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">)</span> <span class="sign">*</span> 
<span class="line_number">572 </span>                <span class="sign">(</span>1 <span class="sign">+</span> nu2dhat <span class="sign">*</span> Setaij<span class="sign">)</span> <span class="sign">-</span> thetahat<span class="sign">^</span>2 <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a> <span class="sign">*</span> Setaij<span class="sign">)</span>
<span class="line_number">573 </span>            rij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> qij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span>
<span class="line_number">574 </span>            sij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> Setaij <span class="sign">/</span> <span class="sign">(</span>1 <span class="sign">+</span> zij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">*</span> Setaij<span class="sign">)</span>
<span class="line_number">575 </span>            pijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> Sdeltaij <span class="sign">/</span> <span class="sign">(</span>1 <span class="sign">+</span> wij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">)</span>
<span class="line_number">576 </span>            qijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>thetahat <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a> <span class="sign">*</span> SDeltaij <span class="sign">/</span> 
<span class="line_number">577 </span>                <span class="sign">(</span><span class="sign">(</span>1 <span class="sign">+</span> nu2hat <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">)</span> <span class="sign">*</span> <span class="sign">(</span>1 <span class="sign">+</span> nu2dhat <span class="sign">*</span> Setaij<span class="sign">)</span> <span class="sign">-</span> 
<span class="line_number">578 </span>                thetahat<span class="sign">^</span>2 <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a> <span class="sign">*</span> Setaij<span class="sign">)</span>
<span class="line_number">579 </span>            rijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="sign">-</span>thetahat <span class="sign">*</span> Sdeltaij <span class="sign">*</span> Setaij <span class="sign">/</span> 
<span class="line_number">580 </span>                <span class="sign">(</span><span class="sign">(</span>1 <span class="sign">+</span> nu2hat <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a><span class="sign">)</span> <span class="sign">*</span> <span class="sign">(</span>1 <span class="sign">+</span> nu2dhat <span class="sign">*</span> Setaij<span class="sign">)</span> <span class="sign">-</span> 
<span class="line_number">581 </span>                thetahat<span class="sign">^</span>2 <span class="sign">*</span> <a href="./bivrec_rZZdebug2FSmuij.html#robo81">Smuij</a> <span class="sign">*</span> Setaij<span class="sign">)</span>
<span class="line_number">582 </span>            sijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> SDeltaij <span class="sign">/</span> <span class="sign">(</span>1 <span class="sign">+</span> zij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">*</span> Setaij<span class="sign">)</span>
<span class="line_number">583 </span>        <span class="sign">}</span>
<span class="line_number">584 </span>        <span class="comment">## Compute pi, qi, etc, as well as wi.</span>
<span class="line_number">585 </span>        piprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>pijprime<span class="sign">[</span>i<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">586 </span>        qiprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>qijprime<span class="sign">[</span>i<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">587 </span>        riprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>rijprime<span class="sign">[</span>i<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">588 </span>        siprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>sijprime<span class="sign">[</span>i<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">589 </span>        
<span class="line_number">590 </span>        pi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>pij<span class="sign">[</span>i<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">591 </span>        qi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>qij<span class="sign">[</span>i<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">592 </span>        ri<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>rij<span class="sign">[</span>i<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">593 </span>        si<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">sum</span><span class="sign">(</span>sij<span class="sign">[</span>i<span class="sign">,</span> <span class="sign">]</span><span class="sign">)</span>
<span class="line_number">594 </span>        
<span class="line_number">595 </span>        wi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 1 <span class="sign">/</span> <span class="sign">(</span><span class="sign">(</span>1 <span class="sign">+</span> sigma2hat <span class="sign">*</span> pi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span> 
<span class="line_number">596 </span>            <span class="sign">(</span>1 <span class="sign">+</span> sigma2dhat <span class="sign">*</span> si<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span> <span class="sign">-</span> sigma2hat <span class="sign">*</span> sigma2dhat <span class="sign">*</span> ri<span class="sign">[</span>i<span class="sign">]</span><span class="sign">^</span>2<span class="sign">)</span>
<span class="line_number">597 </span>    
<span class="line_number">598 </span>        <span class="comment">## Compute cluster frailty estimates</span>
<span class="line_number">599 </span>        Uihat<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 1 <span class="sign">+</span> sigma2hat <span class="sign">*</span> wi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> <span class="sign">(</span><span class="sign">(</span>1 <span class="sign">+</span> sigma2dhat <span class="sign">*</span> si<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span> 
<span class="line_number">600 </span>            <span class="sign">(</span>piprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> pi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">+</span> qiprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> qi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span> <span class="sign">-</span> sigma2dhat <span class="sign">*</span> ri<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> 
<span class="line_number">601 </span>            <span class="sign">(</span>riprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> ri<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">+</span> siprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> si<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span><span class="sign">)</span>
<span class="line_number">602 </span>        Vihat<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 1 <span class="sign">+</span> sigma2dhat <span class="sign">*</span> wi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span> <span class="sign">(</span><span class="sign">(</span>1 <span class="sign">+</span> sigma2hat <span class="sign">*</span> pi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span>
<span class="line_number">603 </span>            <span class="sign">(</span>riprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> ri<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">+</span> siprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> si<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span> <span class="sign">-</span> sigma2hat <span class="sign">*</span> ri<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">*</span>
<span class="line_number">604 </span>            <span class="sign">(</span>piprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> pi<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">+</span> qiprime<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> qi<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span><span class="sign">)</span>
<span class="line_number">605 </span>        
<span class="line_number">606 </span>        <span class="comment">## Compute individual frailty estimates</span>
<span class="line_number">607 </span>        Jicum <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>0<span class="sign">,</span> <span class="keyword">cumsum</span><span class="sign">(</span>Ji<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">608 </span>        <span class="keyword">for</span><span class="sign">(</span>j in 1<span class="sign">:</span>jimax<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">609 </span>            Uijhat<span class="sign">[</span>Jicum<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">+</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> Uihat<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> <span class="sign">(</span>nu2hat <span class="sign">*</span> pij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">+</span> thetahat <span class="sign">*</span>
<span class="line_number">610 </span>                rij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span> Uihat<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> <span class="sign">(</span>nu2hat <span class="sign">*</span> qij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">+</span> thetahat <span class="sign">*</span> sij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span>
<span class="line_number">611 </span>                Vihat<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">+</span> nu2hat <span class="sign">*</span> <span class="sign">(</span>pijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">+</span> qijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span><span class="sign">)</span> <span class="sign">+</span> thetahat <span class="sign">*</span>
<span class="line_number">612 </span>                <span class="sign">(</span>rijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">+</span> sijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">613 </span>            Vijhat<span class="sign">[</span>Jicum<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">+</span> j<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> Vihat<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> <span class="sign">(</span>thetahat <span class="sign">*</span> qij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">+</span> nu2dhat <span class="sign">*</span>
<span class="line_number">614 </span>                sij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span> Vihat<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">-</span> <span class="sign">(</span>thetahat <span class="sign">*</span> pij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">+</span> nu2dhat <span class="sign">*</span> rij<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span><span class="sign">)</span> <span class="sign">*</span>
<span class="line_number">615 </span>                Uihat<span class="sign">[</span>i<span class="sign">]</span> <span class="sign">+</span> thetahat <span class="sign">*</span> <span class="sign">(</span>pijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">+</span> qijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span><span class="sign">)</span> <span class="sign">+</span> nu2dhat <span class="sign">*</span>
<span class="line_number">616 </span>                <span class="sign">(</span>rijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span> <span class="sign">+</span> sijprime<span class="sign">[</span>i<span class="sign">,</span> j<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">617 </span>        <span class="sign">}</span>      
<span class="line_number">618 </span>    <span class="sign">}</span>
<span class="line_number">619 </span>    
<span class="line_number">620 </span>    Uijhat<span class="sign">[</span>Uijhat<span class="sign">&lt;</span><span class="sign">.</span>01<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 0<span class="sign">.</span>01<span class="sign">;</span> Vijhat<span class="sign">[</span>Vijhat <span class="sign">&lt;</span> 0<span class="sign">.</span>01<span class="sign">]</span> <span class="sign">&lt;</span><span class="sign">-</span> 0<span class="sign">.</span>01
<span class="line_number">621 </span>    
<span class="line_number">622 </span>    Uijframe <span class="sign">&lt;</span><span class="sign">-</span> <a href="./bivrec_rutility2FmakeUijframe.html#robo70">makeUijframe</a><span class="sign">(</span>m<span class="sign">,</span> Ji<span class="sign">,</span> Uijhat<span class="sign">,</span> Vijhat<span class="sign">)</span>
<span class="line_number">623 </span>    
<span class="line_number">624 </span>    <span class="keyword">cat</span><span class="sign">(</span><span class="quote">"mean(Uijhat): "</span><span class="sign">,</span> mean<span class="sign">(</span>Uijhat<span class="sign">)</span><span class="sign">,</span> <span class="quote">"   mean(Vijhat): "</span><span class="sign">,</span> mean<span class="sign">(</span>Vijhat<span class="sign">)</span><span class="sign">,</span> <span class="quote">"\n"</span><span class="sign">)</span>
<span class="line_number">625 </span>    <span class="keyword">if</span><span class="sign">(</span>mean<span class="sign">(</span>Uijhat<span class="sign">)</span><span class="sign">&lt;</span><span class="sign">.</span>5 <span class="sign">|</span> mean<span class="sign">(</span>Vijhat<span class="sign">)</span><span class="sign">&lt;</span><span class="sign">.</span>5<span class="sign">)</span> browser<span class="sign">(</span><span class="sign">)</span>
<span class="line_number">626 </span>
<span class="line_number">627 </span>    <span class="keyword">return</span><span class="sign">(</span><span class="keyword">list</span><span class="sign">(</span>Uihat <span class="sign">=</span> Uihat<span class="sign">,</span>
<span class="line_number">628 </span>                Vihat <span class="sign">=</span> Vihat<span class="sign">,</span>
<span class="line_number">629 </span>                Uijhat <span class="sign">=</span> Uijhat<span class="sign">,</span>
<span class="line_number">630 </span>                Vijhat <span class="sign">=</span> Vijhat<span class="sign">,</span>
<span class="line_number">631 </span>                pqrs <span class="sign">=</span> <span class="keyword">list</span><span class="sign">(</span>pij <span class="sign">=</span> pij<span class="sign">,</span> qij <span class="sign">=</span> qij<span class="sign">,</span> rij <span class="sign">=</span> rij<span class="sign">,</span> sij <span class="sign">=</span> sij<span class="sign">,</span>
<span class="line_number">632 </span>                    pijprime <span class="sign">=</span> pijprime<span class="sign">,</span> qijprime <span class="sign">=</span> qijprime<span class="sign">,</span>
<span class="line_number">633 </span>                    rijprime <span class="sign">=</span> rijprime<span class="sign">,</span> sijprime <span class="sign">=</span> sijprime<span class="sign">,</span>
<span class="line_number">634 </span>                    pi <span class="sign">=</span> pi<span class="sign">,</span> qi <span class="sign">=</span> qi<span class="sign">,</span> ri <span class="sign">=</span> ri<span class="sign">,</span> si <span class="sign">=</span> si<span class="sign">,</span>
<span class="line_number">635 </span>                    piprime <span class="sign">=</span> piprime<span class="sign">,</span> qiprime <span class="sign">=</span> qiprime<span class="sign">,</span>
<span class="line_number">636 </span>                    riprime <span class="sign">=</span> riprime<span class="sign">,</span> siprime <span class="sign">=</span> siprime<span class="sign">,</span>
<span class="line_number">637 </span>                    wi <span class="sign">=</span> wi<span class="sign">,</span> zij <span class="sign">=</span> zij<span class="sign">,</span> wij <span class="sign">=</span> wij<span class="sign">)</span><span class="sign">,</span>
<span class="line_number">638 </span>                Uijframe <span class="sign">=</span> Uijframe<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">639 </span><span class="sign">}</span>
</pre>

</div> <!-- content -->
<div id="footer">
<p>Generated from ./blupsurv/R/bivrec.r with <a href="http://www.xs4all.nl/~rfsber/Robo/robodoc.html">ROBODoc</a> V4.99.36 on Wed Jul 16 2008 11:47:16
</p>
</div> <!-- footer -->

<!-- Start of StatCounter Code -->
<script type="text/javascript">
var sc_project=3825293; 
var sc_invisible=1; 
var sc_partition=34; 
var sc_click_stat=1; 
var sc_security="2dd2334a"; 
</script>

<script type="text/javascript"
src="http://www.statcounter.com/counter/counter_xhtml.js"></script><noscript><div
class="statcounter"><a href="http://www.statcounter.com/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/3825293/0/2dd2334a/1/" alt="free html hit
counter" ></a></div></noscript>
<!-- End of StatCounter Code -->
</body>

</html>
